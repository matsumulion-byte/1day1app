<!doctype html>
<html lang="ja">
<head>
  <!-- OGP AUTO-GENERATED START (do not edit by hand) -->
  <meta property="og:title" content="æ¾æ‘ã‚»ã‚¯ã‚·ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯å´©ã—2">
  <meta name="twitter:title" content="æ¾æ‘ã‚»ã‚¯ã‚·ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯å´©ã—2">
  <meta property="og:description" content="æ¾æ‘ã‚»ã‚¯ã‚·ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯å´©ã—ï¼ˆ2é¢ï¼‰ Score: 0 Lives: 3 â¸ ä¸€æ™‚åœæ­¢ / ğŸ”„ ãƒªã‚»ãƒƒãƒˆ ã¯ä¸‹ã®ãƒœã‚¿ãƒ³ â¸ ä¸€æ™‚åœæ­¢ ğŸ”„ ãƒªã‚»ãƒƒãƒˆ æ¾æ‘ã§ã™ï¼ ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ ã‚‚ã†ä¸€åº¦ã‚ãã¶">
  <meta name="twitter:description" content="æ¾æ‘ã‚»ã‚¯ã‚·ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯å´©ã—ï¼ˆ2é¢ï¼‰ Score: 0 Lives: 3 â¸ ä¸€æ™‚åœæ­¢ / ğŸ”„ ãƒªã‚»ãƒƒãƒˆ ã¯ä¸‹ã®ãƒœã‚¿ãƒ³ â¸ ä¸€æ™‚åœæ­¢ ğŸ”„ ãƒªã‚»ãƒƒãƒˆ æ¾æ‘ã§ã™ï¼ ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ ã‚‚ã†ä¸€åº¦ã‚ãã¶">
  <meta property="og:image" content="/2025-12-11/assets/matsumura_photo.jpg">
  <meta name="twitter:image" content="/2025-12-11/assets/matsumura_photo.jpg">
  <meta property="og:url" content="/2025-12-11/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <!-- OGP AUTO-GENERATED END -->

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
<title>æ¾æ‘ã‚»ã‚¯ã‚·ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯å´©ã—2</title>
<style>
  :root{
    color-scheme: light dark;
    --bg:#0b0f14; --fg:#e8eef5; --muted:#8aa0b2;
    --brick:#122032; --brickLine:rgba(255,255,255,.06);
    --paddle:#eab308; --ball:#e5e7eb;
  }
  html,body{height:100%;margin:0}
  body{
    background:var(--bg); color:var(--fg);
    font-family:ui-sans-serif,system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
    display:flex; flex-direction:column; align-items:center; gap:10px
  }
  header{padding:10px 12px 0; width:min(720px,100%); box-sizing:border-box}
  header h1{margin:0; font-size:16px}
  header .sub{font-size:12px; color:var(--muted)}
  /* PCã§å·¨å¤§åŒ–ã—ãªã„ã‚ˆã†å¹…/é«˜ã•ã‚’åˆ¶é™ã€‚ã‚¹ãƒãƒ›ã¯æ¨ªå¹…ãƒ•ã‚£ãƒƒãƒˆ */
  #wrap{
    position:relative;
    width:min(420px, 90vw);
    max-height:90vh;
    aspect-ratio:9 / 16;   /* ç¸¦é•·å‰æ */
    background:#0e141a;
    border-radius:16px; overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,.35)
  }
  canvas{width:100%; height:100%; display:block; touch-action:none; background:#080c11}
  .hud{position:absolute; inset:0; pointer-events:none; display:flex; flex-direction:column; padding:10px}
  .hud .top{display:flex; justify-content:space-between; font-weight:700; font-size:13px}
  .btnbar{position:absolute; inset:auto 0 10px; display:flex; justify-content:center; gap:10px; pointer-events:auto}
  .btn{background:#17202a; border:1px solid #1f2b37; color:var(--fg); padding:8px 12px; border-radius:12px; font-size:13px}
  .hint{position:absolute; inset:auto 0 60px; text-align:center; color:#cbd5e1; font-size:12px; opacity:.85}
  .overlay{position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:linear-gradient(180deg,rgba(0,0,0,.5),rgba(0,0,0,.72))}
  .overlay.show{display:flex}
  .card{background:#0f1620; border:1px solid #1f2b37; padding:18px; border-radius:16px; width:min(90%,460px); text-align:center}
  .card h2{margin:0 0 8px; font-size:20px}
  .card p{margin:6px 0 14px; color:var(--muted)}
  .card button{all:unset; background:#34d399; color:#052017; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer}
  /* ==== ã‚¹ãƒãƒ›ã§ã®ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚„ãƒã‚¤ãƒ©ã‚¤ãƒˆç„¡åŠ¹ ==== */
canvas, button, body {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;  /* é•·æŠ¼ã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç„¡åŠ¹ï¼ˆç”»åƒä¿å­˜ã¨ã‹ï¼‰ */
  -webkit-tap-highlight-color: transparent; /* é’ã„ãƒã‚¤ãƒ©ã‚¤ãƒˆç„¡åŠ¹ */
}

</style>
</head>
<body>
  <header>
    <h1>æ¾æ‘ã‚»ã‚¯ã‚·ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯å´©ã—ï¼ˆ2é¢ï¼‰</h1>
  </header>

  <div id="wrap">
    <canvas id="game"></canvas>
    <div class="hud">
      <div class="top">
        <div>Score: <span id="sc">0</span></div>
        <div>Lives: <span id="lv">3</span></div>
      </div>
    </div>
    <div class="hint">â¸ ä¸€æ™‚åœæ­¢ / ğŸ”„ ãƒªã‚»ãƒƒãƒˆ ã¯ä¸‹ã®ãƒœã‚¿ãƒ³</div>
    <div class="btnbar">
      <button class="btn" id="pauseBtn">â¸ ä¸€æ™‚åœæ­¢</button>
      <button class="btn" id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="overlay" id="ovl">
      <div class="card">
        <h2 id="ovlTitle">æ¾æ‘ã§ã™ï¼</h2>
        <p id="ovlMsg">ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
        <button id="againBtn">ã‚‚ã†ä¸€åº¦ã‚ãã¶</button>
      </div>
    </div>
  </div>

<script type="module">
/* å‹•çš„ã‚¢ã‚»ãƒƒãƒˆ
   é…ç½®å ´æ‰€ã‚’çµ¶å¯¾ãƒ‘ã‚¹ã§å›ºå®šã—ã€Vercel ãƒ«ãƒ¼ãƒˆé…ä¿¡æ™‚ã®ãšã‚Œã‚’é˜²ã */
const asset = (p) => `/apps/2025-12-11/assets/${p}`;
/* ===== è¨­å®š ===== */
// ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã® assets ã‚’è¦‹ã‚‹ã‚ˆã†ã«ä¿®æ­£ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«/æœ¬ç•ªä¸¡å¯¾å¿œï¼‰
const PHOTO_FILE = asset("matsumura_photo.jpg");

const CFG = {
  /* ãƒ–ãƒ­ãƒƒã‚¯ç²’åº¦ï¼šå¤šã™ããšå°‘ãªã™ããš */
  cols: 6,
  rows: 6,

  /* ã”æŒ‡å®šã®ä¸Šä¸‹ãƒãƒ¼ã‚¸ãƒ³ */
  marginTop: 150,     // â† ä¸Šãƒãƒ¼ã‚¸ãƒ³ï¼ˆpxï¼‰
  marginBottom: 200,  // â† ä¸‹ãƒãƒ¼ã‚¸ãƒ³ï¼ˆpxï¼‰

  gap: 4,             // ãƒ–ãƒ­ãƒƒã‚¯ã®éš™é–“(px)
  wall: 12,           // å·¦å³ã®å£ãƒãƒ¼ã‚¸ãƒ³(px)

  /* ãƒ‘ãƒ‰ãƒ«ï¼ãƒœãƒ¼ãƒ« */
  ballSpeed: 6.0,
  ballRadius: 9,
  ballMax: 14,
  paddleW: 150,
  paddleH: 16,
  paddleBottom: 100,   // â† ç”»é¢ä¸‹ã‹ã‚‰ãƒ‘ãƒ‰ãƒ«ã¾ã§ã®è·é›¢ï¼ˆã”æŒ‡å®šã«åˆã‚ã›ã¦100ï¼‰
};

/* ===== å‚ç…§ ===== */
const wrap = document.getElementById("wrap");
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scEl = document.getElementById("sc");
const lvEl = document.getElementById("lv");
const pauseBtn = document.getElementById("pauseBtn");
const resetBtn = document.getElementById("resetBtn");
const ovl = document.getElementById("ovl");
const againBtn = document.getElementById("againBtn");
const ovlTitle = document.getElementById("ovlTitle");
const ovlMsg = document.getElementById("ovlMsg");

/* ===== çŠ¶æ…‹ ===== */
let DPR = Math.max(1, window.devicePixelRatio || 1);
let W = 0, H = 0;          // CSSãƒ”ã‚¯ã‚»ãƒ«åŸºæº–
let photoImg = new Image(), photoReady = false;

let bricks = [];           // {x,y,w,h,hp}
let ball = {x:0,y:0,vx:0,vy:0,r:CFG.ballRadius, stuck:true};
let paddle = {x:0,y:0,w:CFG.paddleW,h:CFG.paddleH};
let score = 0, lives = 3;
let paused = false, gameOver = false, cleared = false;

/* ===== ç”»åƒ ===== */
function loadPhoto(src){
  return new Promise((res, rej)=>{
    const img=new Image(); img.onload=()=>res(img); img.onerror=rej; img.src=src;
  });
}

/* ===== ãƒªã‚µã‚¤ã‚ºï¼ˆDPRæ­£ã—ãï¼‰===== */
function fitCanvas(){
  const rect = wrap.getBoundingClientRect();
  const cssW = rect.width, cssH = rect.height;
  DPR = Math.max(1, window.devicePixelRatio || 1);
  canvas.width  = Math.round(cssW * DPR);
  canvas.height = Math.round(cssH * DPR);
  // ä»¥é™ã®æç”»ã¯CSSãƒ”ã‚¯ã‚»ãƒ«åŸºæº–
  ctx.setTransform(DPR,0,0,DPR,0,0);
  W = cssW; H = cssH;
}

/* ===== ãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆ ===== */
function buildBricks(){
  bricks = [];
  const {cols,rows,gap,wall} = CFG;
  const gridW = (W - wall*2);
  const gridH = (H - CFG.marginTop - CFG.marginBottom);
  const bw = Math.floor((gridW - gap*(cols-1)) / cols);
  const bh = Math.floor((gridH - gap*(rows-1)) / rows);

  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const x = wall + c*(bw+gap);
      const y = CFG.marginTop + r*(bh+gap);
      bricks.push({x,y,w:bw,h:bh,hp:1});
    }
  }
}

/* ===== åˆæœŸåŒ– ===== */
async function reset(all=false){
  if(all){ score=0; lives=3; }
  paused=false; gameOver=false; cleared=false; hideOverlay();

  if(!photoReady){ photoImg = await loadPhoto(PHOTO_FILE); photoReady = true; }
  fitCanvas(); buildBricks();

  // ãƒ‘ãƒ‰ãƒ«ï¼ãƒœãƒ¼ãƒ«åˆæœŸä½ç½®
  paddle.w = Math.min(CFG.paddleW, W*0.20);
  paddle.h = CFG.paddleH;
  paddle.x = (W - paddle.w)/2;
  paddle.y = H - CFG.paddleBottom;

  ball.r = CFG.ballRadius;
  ball.x = paddle.x + paddle.w/2;
  ball.y = paddle.y - 14;
  ball.vx = 0; ball.vy = 0; ball.stuck = true;

  scEl.textContent = score; lvEl.textContent = lives;
}

/* ===== å…¥åŠ›ï¼ˆPC:ç§»å‹•ã ã‘ã§è¿½å¾“ï¼ã‚¯ãƒªãƒƒã‚¯ã§ç™ºå°„ï¼‰ ===== */
function toCanvasX(clientX){
  const rect = canvas.getBoundingClientRect();
  const ratio = canvas.width / rect.width;
  return (clientX - rect.left) * ratio / DPR;
}
canvas.addEventListener("pointermove",(e)=>{
  // ãƒã‚¦ã‚¹ç§»å‹•ã ã‘ã§è¿½å¾“ï¼ˆã‚¹ãƒãƒ›ã§ã‚‚OKï¼‰
  paddle.x = Math.min(Math.max(toCanvasX(e.clientX) - paddle.w/2, 0), W - paddle.w);
});
canvas.addEventListener("pointerdown",()=>{
  if(ball.stuck) launchBall();
});
// 2æœ¬æŒ‡ã§ä¸€æ™‚åœæ­¢
canvas.addEventListener("touchstart",(e)=>{ if(e.touches?.length>=2) paused=!paused; },{passive:true});

window.addEventListener("resize", ()=>{
  const px = (paddle.x || 0) / (W || 1);
  const bx = (ball.x || 0) / (W || 1), by = (ball.y || 0) / (H || 1);
  fitCanvas(); buildBricks();
  paddle.x = (W - paddle.w)*px;
  ball.x = W*bx; ball.y = H*by;
});

/* ===== ãƒœã‚¿ãƒ³ ===== */
pauseBtn.addEventListener("click", ()=> paused = !paused);
resetBtn.addEventListener("click", ()=> reset(true));
againBtn.addEventListener("click", ()=> reset(true));

/* ===== ç™ºå°„ ===== */
function effectiveBallSpeed(){ return CFG.ballSpeed; }
function launchBall(){
  const base = (Math.random()<0.5? -1:1) * 0.38;  // å·¦å³ãƒ©ãƒ³ãƒ€ãƒ 
  const angle = (-Math.PI/2) + base;
  const speed = effectiveBallSpeed();
  ball.vx = speed*Math.cos(angle);
  ball.vy = speed*Math.sin(angle);
  ball.stuck = false;
}

/* ===== è¡çªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
function rectHitCircle(rx,ry,rw,rh,cx,cy,cr){
  const nx = Math.max(rx, Math.min(cx, rx+rw));
  const ny = Math.max(ry, Math.min(cy, ry+rh));
  const dx = cx - nx, dy = cy - ny;
  return (dx*dx + dy*dy) <= cr*cr;
}

/* ===== æ›´æ–° ===== */
function update(){
  if(paused || gameOver || cleared) return;

  // ãƒ‘ãƒ‰ãƒ«è¿½å¾“ä¸­
  if(ball.stuck){
    ball.x = Math.max(ball.r, Math.min(W - ball.r, paddle.x + paddle.w/2));
    ball.y = paddle.y - 14;
  }else{
    // ãƒœãƒ¼ãƒ«ç§»å‹•
    ball.x += ball.vx; ball.y += ball.vy;

    // å£
    if(ball.x - ball.r < 0){ ball.x = ball.r; ball.vx *= -1; }
    if(ball.x + ball.r > W){ ball.x = W - ball.r; ball.vx *= -1; }
    if(ball.y - ball.r < 0){ ball.y = ball.r; ball.vy *= -1; }
// åå°„å¾Œã«è¿½åŠ 
const minVy = 2.5; // ä¸‹æ–¹å‘ã®æœ€å°ã‚¹ãƒ”ãƒ¼ãƒ‰
if (Math.abs(ball.vy) < minVy) {
  ball.vy = (ball.vy < 0 ? -1 : 1) * minVy;
}

    // ãƒ‘ãƒ‰ãƒ«
    if(rectHitCircle(paddle.x,paddle.y,paddle.w,paddle.h, ball.x,ball.y,ball.r)){
      // åå°„è§’ï¼šãƒ’ãƒƒãƒˆä½ç½®ä¾å­˜
      const hitPos = (ball.x - paddle.x) / paddle.w; // 0..1
      const angle = (Math.PI * (0.9 * (hitPos - 0.5))) - Math.PI/2;
      const speed = Math.min(CFG.ballMax, Math.max(effectiveBallSpeed(), Math.hypot(ball.vx,ball.vy)));
      ball.x = Math.max(ball.r, Math.min(W-ball.r, ball.x));
      ball.y = paddle.y - ball.r;      // ã‚ã‚Šè¾¼ã¿é˜²æ­¢
      ball.vx = speed*Math.cos(angle);
      ball.vy = -Math.abs(speed*Math.sin(angle));
    }

    // è½ä¸‹ãƒŸã‚¹
    if(ball.y - ball.r > H){
      lives--; lvEl.textContent = lives;
      if(lives<=0){ gameOver = true; showOverlay("ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼","ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼"); return; }
      // ãƒ‘ãƒ‰ãƒ«ä¸Šã«å¾©å¸°
      ball.stuck = true; ball.vx = 0; ball.vy = 0;
    }
  }

  // ãƒ–ãƒ­ãƒƒã‚¯è¡çª
  let breakables = 0;
  for(const b of bricks){
    if(b.hp>0) breakables++;
    if(b.hp<=0) continue;

    if(rectHitCircle(b.x,b.y,b.w,b.h, ball.x,ball.y,ball.r)){
      // ã©ã®é¢ã«å½“ãŸã£ãŸã‹ï¼ˆï¼‹æŠ¼ã—å‡ºã—ã§ãƒãƒã‚Šé˜²æ­¢ï¼‰
      const dx = (ball.x - (b.x + b.w/2)) / (b.w/2);
      const dy = (ball.y - (b.y + b.h/2)) / (b.h/2);
      if(Math.abs(dx)*1.1 > Math.abs(dy)){
        // æ¨ªå´
        if(dx > 0) ball.x = b.x + b.w + ball.r;
        else       ball.x = b.x - ball.r;
        ball.vx *= -1;
      }else{
        // ä¸Šä¸‹å´
        if(dy > 0) ball.y = b.y + b.h + ball.r;
        else       ball.y = b.y - ball.r;
        ball.vy *= -1;
      }

      // å£Šã™
      b.hp = 0;
      score += 100; scEl.textContent = score;
    }
  }

  if(breakables === 0){
    cleared = true;
    showOverlay("æ¾æ‘ã§ã™ï¼","ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼");
  }
}

/* ===== æç”» ===== */
function render(){
  // èƒŒæ™¯ã«å†™çœŸï¼ˆcoverï¼‰
  if(photoReady){
    const cw=W, ch=H, iw=photoImg.width, ih=photoImg.height;
    const cr=cw/ch, ir=iw/ih; let dw, dh, dx, dy;
    if(ir>cr){ const s=ch/ih; dw=iw*s; dh=ih*s; } else { const s=cw/iw; dw=iw*s; dh=ih*s; }
    dx=(cw-dw)/2; dy=(ch-dh)/2;
    ctx.drawImage(photoImg, dx, dy, dw, dh);
  }else{
    ctx.fillStyle="#0a0f14"; ctx.fillRect(0,0,W,H);
  }

  // å£Šã‚Œã¦ã„ãªã„ãƒ–ãƒ­ãƒƒã‚¯ã ã‘æç”»ï¼ˆè¦†ã„ï¼‰
  for(const b of bricks){
    if(b.hp<=0) continue;
    ctx.fillStyle= getComputedStyle(document.documentElement).getPropertyValue('--brick') || "#122032";
    ctx.fillRect(b.x,b.y,b.w,b.h);
    ctx.strokeStyle= getComputedStyle(document.documentElement).getPropertyValue('--brickLine') || "rgba(255,255,255,.06)";
    ctx.strokeRect(b.x+.5,b.y+.5,b.w-1,b.h-1);
  }

  // ãƒ‘ãƒ‰ãƒ«
  ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--paddle')||"#eab308";
  ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);
  // ãƒœãƒ¼ãƒ«
  ctx.beginPath(); ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
  ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--ball')||"#e5e7eb"; ctx.fill();
}

/* ===== ãƒ«ãƒ¼ãƒ— ===== */
function loop(){ update(); render(); requestAnimationFrame(loop); }

/* ===== ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ===== */
function showOverlay(t,m){ ovlTitle.textContent=t; ovlMsg.textContent=m; ovl.classList.add("show"); }
function hideOverlay(){ ovl.classList.remove("show"); }

/* ===== èµ·å‹• ===== */
await reset(true);
requestAnimationFrame(loop);
</script>
</body>
</html>

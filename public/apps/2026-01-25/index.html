<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="theme-color" content="#0b1020" />
  <title>ãŠè©«ã³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ï½œãƒŠãƒ³ã‚»ãƒ³ã‚¹</title>
  <style>
    :root{
      --bg:#0b1020;
      --ink:#f3f6ff;
      --muted:rgba(243,246,255,.72);
      --line:rgba(255,255,255,.14);
      --panel:rgba(255,255,255,.08);
      --accent:#60a5fa;
      --r:18px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%; background:var(--bg); color:var(--ink)}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      overflow:hidden;
      -webkit-font-smoothing:antialiased;
      touch-action: manipulation;
    }
    .wrap{
      height:100%;
      display:flex;
      flex-direction:column;
      gap:14px;
      padding: max(14px, env(safe-area-inset-top)) 14px max(14px, env(safe-area-inset-bottom));
      overflow:hidden;
    }
    header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .ttl{display:flex;flex-direction:column;gap:4px;min-width:0}
    .ttl h1{font-size:18px;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .ttl p{font-size:12px;color:var(--muted)}
    .pill{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      user-select:none;
      flex:0 0 auto;
    }

    .card{
      flex:1; min-height:0;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      border-radius:var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .content{
      padding:12px;
      display:grid;
      grid-template-columns: 96px 1fr;
      gap:12px;
      align-items:start;
      min-height:0;
    }
    .imgBox{
      width:96px; aspect-ratio:1/1;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      overflow:hidden;
      position:relative;
    }
    .imgBox img{width:100%;height:100%;object-fit:cover;display:block}
    .imgFallback{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap:6px;
      color:var(--muted);
      font-size:11px;
      padding:10px;
      text-align:center;
      word-break:break-word;
    }

    .texts{min-width:0;display:flex;flex-direction:column;gap:10px}
    .box{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      border-radius:16px;
      padding:10px;
    }
    .k{font-size:11px;color:var(--muted);margin-bottom:6px}
    .v{font-size:14px;line-height:1.55;white-space:pre-wrap;word-break:break-word}

    .controls{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
      padding:12px;
      border-top:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background:rgba(255,255,255,.08);
      color:var(--ink);
      padding:12px 12px;
      border-radius:14px;
      font-weight:700;
      font-size:14px;
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      width:100%;
      min-width:0;
      white-space:nowrap;
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      border-color: rgba(96,165,250,.55);
      background:rgba(96,165,250,.18);
    }

    .toast{
      position:fixed;
      left:50%;
      bottom: calc(14px + env(safe-area-inset-bottom));
      transform:translateX(-50%);
      background:rgba(0,0,0,.65);
      border:1px solid rgba(255,255,255,.18);
      color:var(--ink);
      padding:10px 12px;
      border-radius:999px;
      font-size:12px;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
      z-index:5;
      white-space:nowrap;
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}

    @media (min-width: 720px){
      .controls{grid-template-columns: repeat(4, minmax(0, 1fr))}
    }
    @media (min-width: 820px){
      .content{grid-template-columns: 120px 1fr}
      .imgBox{width:120px;border-radius:18px}
      .ttl h1{font-size:20px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="ttl">
        <h1>ãŠè©«ã³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
        <p>ãƒŠãƒ³ã‚»ãƒ³ã‚¹ãªçŠ¶æ³ Ã— ãã‚Œã£ã½ã„ãŠè©«ã³ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰</p>
      </div>
      <div class="pill" id="seedPill">seed: â€”</div>
    </header>

    <section class="card">
      <div class="content">
        <div class="imgBox" title="æ¾æ‘ãŒè¬ã£ã¦ã„ã‚‹ç”»åƒ">
          <img id="sorryImg" alt="æ¾æ‘ãŒè¬ã£ã¦ã„ã‚‹ç”»åƒ" />
          <div class="imgFallback" id="imgFallback" hidden>
            <div>ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>
            <div style="opacity:.9">/assets/matsumura_sorry.png</div>
          </div>
        </div>

        <div class="texts">
          <div class="box">
            <div class="k">ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³</div>
            <div class="v" id="scenarioText">â€”</div>
          </div>

          <div class="box">
            <div class="k">ãŠè©«ã³æ–‡</div>
            <div class="v" id="apologyText">â€”</div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn primary" id="btnGenerate" type="button">ğŸ² ã‚‚ã†ä¸€å›</button>
        <button class="btn" id="btnCopy" type="button">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
        <button class="btn" id="btnCopyAll" type="button">ã¾ã¨ã‚ã¦ã‚³ãƒ”ãƒ¼</button>
        <button class="btn" id="btnShare" type="button">å…±æœ‰</button>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">Copied</div>

  <script type="module">
    const asset = (p) => {
      const basePath = window.location.pathname.replace(/\/$/, '') || '';
      const relativePath = p.startsWith('./') ? p.slice(2) : p;
      return `${basePath}/${relativePath}`;
    };

    // UIã«ã¯å‡ºã•ãªã„å†…éƒ¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆèªå°¾ã®æºã‚Œç”¨ï¼‰
    const TONE = ["hard","mid","soft"];
    const LEVEL = ["light","mid","heavy"];

    // ä»•äº‹ã£ã½ã•ã‚’é¿ã‘ã‚‹ï¼šä¼šè­°/ç´å“/è³‡æ–™/è¦‹ç©/ã‚µãƒ¼ãƒãƒ¼/Slack/Zoom ãªã©ã‚’æ’é™¤
    // ã€Œç¾å®Ÿã«ã‚ã‚Šãã†ã€ã‚’é¿ã‘ã¦ã€ç‰©ç†æ³•å‰‡ãƒ»ä¸–ç•Œè¦³ãŒå´©ã‚Œã‚‹ç³»ã«å¯„ã›ã‚‹
    const SITUATIONS = [
      "è²·ã£ãŸã¯ãšã®ã‚¢ã‚¤ã‚¹ãŒã€å®¶ã«ç€ã„ãŸã‚‰\"ãƒ’ãƒ¨ã‚³\"ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚",
      "è‡ªåˆ†ã®å‚˜ã ã‘ã€é›¨ã«é¿ã‘ã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚",
      "è‡ªå‹•ãƒ‰ã‚¢ãŒè‡ªåˆ†ã«ã ã‘åå¿œã›ãšã€æ°—ã¾ãšã„æ™‚é–“ãŒæµã‚Œã¾ã—ãŸã€‚",
      "é´ã‚’å·¦å³ãƒãƒ©ãƒãƒ©ã«å±¥ã„ã¦å¤–å‡ºã—ã€é€”ä¸­ã§æ°—ã¥ã„ãŸã®ã§é…åˆ»ã—ã¾ã—ãŸã€‚",
      "ç‚Šé£¯å™¨ã‚’é–‹ã‘ãŸã‚‰ã€ãã“ã¯ç•°ä¸–ç•Œã§ã—ãŸã€‚",
      "ç›®è¦šã¾ã—ã‚’æ­¢ã‚ãŸã®ã«ã€å¤¢ã®ä¸­ã§é³´ã‚Šç¶šã‘ã¦ã„ã¾ã—ãŸã€‚",
      "é›»å­ãƒ¬ãƒ³ã‚¸ã§æ¸©ã‚ãŸã®ã«ã€ãªãœã‹å†·ãˆã¦å‡ºã¦ãã¾ã—ãŸã€‚",
      "æ´—æ¿¯ç‰©ã‚’å¹²ã—ãŸç¬é–“ã ã‘ã€ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆã§é›¨ãŒé™ã‚Šã¾ã—ãŸã€‚",
      "ã‚³ãƒ³ãƒ“ãƒ‹è¢‹ã‚’é–‹ã‘ãŸã‚‰ã€è²·ã£ãŸè¨˜æ†¶ã®ãªã„ãŠè“å­ãŒå…¥ã£ã¦ã„ã¾ã—ãŸã€‚",
      "é´ã²ã‚‚ã‚’çµã‚“ã ã¯ãšãŒã€é‹å‘½ã®äººã¨çµã°ã‚Œã¦ã„ã¾ã—ãŸ",
      "ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã®ãƒ•ã‚¿ãŒç¡¬ã™ãã¦1å¹´åŠãŒéãã¾ã—ãŸã€‚",
      "ãƒ¬ã‚·ãƒ¼ãƒˆãŒé•·ã™ãã¦ã€æŒã¡å¸°ã‚Šç”¨ã®ç­’ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸã€‚",
      "å†™çœŸã‚’æ’®ã£ãŸã‚‰ã€è‡ªåˆ†ã ã‘å…¨éƒ¨ãƒ–ãƒ¬ã¦ã„ã¾ã—ãŸã€‚",
      "æ”¹æœ­ã‚’é€šã£ãŸã‚‰ã€ãƒ”ãƒƒã§ã¯ãªã\"ãŸã‚æ¯\"ã¿ãŸã„ãªéŸ³ãŒã—ã¾ã—ãŸã€‚",
      "ã‚¤ãƒ¤ãƒ›ãƒ³ã‚’å·®ã—ãŸã®ã«ã€éŸ³ãŒå…¨éƒ¨ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‹ã‚‰å‡ºã¦ã„ã¾ã—ãŸã€‚",
      "å®¶ã®éµã‚’é–‹ã‘ãŸã‚‰ã€è‡ªåˆ†ã®å®¶ãªã®ã«\"ã‚ˆã†ã“ã\"ã¨è¨€ã‚ã‚Œã¾ã—ãŸã€‚",
      "å®…é…ä¾¿ã®å—ã‘å–ã‚Šã‚µã‚¤ãƒ³ã‚’å°å­¦æ ¡ã®æ™‚ã«ç·´ç¿’ã—ãŸã®ã§æ›¸ã„ã¦ã—ã¾ã—ã¾ã—ãŸã€‚",
      "ç‰‡æ–¹ã ã‘ã®é´ä¸‹ãŒ10è¶³ã‚’è¶…ãˆã¾ã—ãŸã€‚",
      "é›»è»Šã§åº§ã£ãŸç¬é–“ã«çµ‚ç‚¹ã«ã¤ã„ã¦ã„ã¾ã—ãŸã€‚",
      "ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãªãã¦ãšã£ã¨1éšã«ã„ã¾ã—ãŸã€‚",
      "é«ªã‚’åˆ‡ã£ãŸã®ã«ã€èª°ã«ã‚‚æ°—ã¥ã‹ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚",
    ];

    function mulberry32(seed){
      return function(){
        let t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }
    const pick = (rng, arr) => arr[Math.floor(rng() * arr.length)];

    // ãŠè©«ã³æ–‡ã‚‚ã€Œä»•äº‹ã®å®šå‹ã€ã‚’è–„ã‚ã‚‹ï¼ˆãŸã ã—â€œãã‚Œã£ã½ã•â€ã¯æ®‹ã™ï¼‰
    const OPEN = {
      hard:["æã‚Œå…¥ã‚Šã¾ã™ã€‚","å¤±ç¤¼ã„ãŸã—ã¾ã™ã€‚","ã¾ãšã¯ãŠè©«ã³ç”³ã—ä¸Šã’ã¾ã™ã€‚"],
      mid:["ã™ã¿ã¾ã›ã‚“ã€‚","å¤±ç¤¼ã—ã¾ã—ãŸã€‚","ç”³ã—è¨³ãªã„ã§ã™ã€‚"],
      soft:["ã”ã‚ã‚“ãªã•ã„â€¦ï¼","ã»ã‚“ã¨ã”ã‚ã‚“â€¦ï¼","ã™ã¿ã¾ã›ã‚“â€¦ï¼"]
    };
    const BODY = {
      hard:{
        light:["ä¸æ‰‹éš›ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚","é…æ…®ãŒè¶³ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚","å–ã‚Šæ‰±ã„ãŒé›‘ã§ã—ãŸã€‚"],
        mid:["æ··ä¹±ã‚’æ‹›ãã¾ã—ãŸã€‚","ã”è¿·æƒ‘ã‚’ãŠã‹ã‘ã—ã¾ã—ãŸã€‚","çŠ¶æ³ã‚’æ‚ªåŒ–ã•ã›ã¾ã—ãŸã€‚"],
        heavy:["æ·±åˆ»ãªäº‹æ…‹ã‚’æ‹›ãã¾ã—ãŸã€‚","å–ã‚Šè¿”ã—ã®ã¤ã‹ãªã„æ„Ÿã˜ã«ã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚","ä¸–ç•Œè¦³ã‚’å´©ã—ã¾ã—ãŸã€‚"]
      },
      mid:{
        light:["ã‚„ã‚‰ã‹ã—ã¾ã—ãŸã€‚","ãƒŸã‚¹ã‚Šã¾ã—ãŸã€‚","ã†ã£ã‹ã‚Šã—ã¾ã—ãŸã€‚"],
        mid:["ã ã„ã¶ã‚„ã‚‰ã‹ã—ã¾ã—ãŸã€‚","ã‘ã£ã“ã†ãƒŸã‚¹ã‚Šã¾ã—ãŸã€‚","å®Œå…¨ã«ã†ã£ã‹ã‚Šã§ã—ãŸã€‚"],
        heavy:["ã‹ãªã‚Šã‚„ã‚‰ã‹ã—ã¾ã—ãŸã€‚","è‡´å‘½çš„ã«ãƒŸã‚¹ã‚Šã¾ã—ãŸã€‚","ã‚‚ã†è¨€ã„è¨³ã§ããªã„æ„Ÿã˜ã§ã™ã€‚"]
      },
      soft:{
        light:["ã‚„ã£ã¡ã‚ƒã„ã¾ã—ãŸâ€¦ï¼","ã†ã£ã‹ã‚Šã§ã—ãŸâ€¦ï¼","ã”ã‚ã‚“ãªã•ã„â€¦ï¼"],
        mid:["ã ã„ã¶ã‚„ã£ã¡ã‚ƒã„ã¾ã—ãŸâ€¦ï¼","å®Œå…¨ã«ã†ã£ã‹ã‚Šã§ã™â€¦ï¼","ã»ã‚“ã¨ã™ã¿ã¾ã›ã‚“â€¦ï¼"],
        heavy:["å¤§äº‹ä»¶ã«ã—ã¡ã‚ƒã„ã¾ã—ãŸâ€¦ï¼","ä¸–ç•Œã«è¿·æƒ‘ã‹ã‘ã¾ã—ãŸâ€¦ï¼","å–ã‚Šè¿”ã—ãŸã„ã§ã™â€¦ï¼"]
      }
    };
    const FIX = {
      hard:["ç›´ã¡ã«æ•´ãˆã¾ã™ã€‚","åŸå› ã‚’è¿½ã„ã¾ã™ã€‚","å†ç™ºé˜²æ­¢ã«åŠªã‚ã¾ã™ã€‚"],
      mid:["è½ã¡ç€ã„ã¦ç›´ã—ã¾ã™ã€‚","ã„ã£ãŸã‚“æ•´ãˆç›´ã—ã¾ã™ã€‚","ã¡ã‚ƒã‚“ã¨æˆ»ã—ã¾ã™ã€‚"],
      soft:["ã™ãç›´ã—ã¾ã™â€¦ï¼","ã¡ã‚ƒã‚“ã¨ã—ã¾ã™â€¦ï¼","ãŒã‚“ã°ã£ã¦æˆ»ã—ã¾ã™â€¦ï¼"]
    };
    const CLOSE = {
      hard:["ä½•å’ã”å®¹èµ¦ãã ã•ã„ã€‚","ä»¥å¾Œæ°—ã‚’ã¤ã‘ã¾ã™ã€‚","ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"],
      mid:["ä»¥å¾Œæ°—ã‚’ã¤ã‘ã¾ã™ã€‚","è¨±ã—ã¦ãã ã•ã„ã€‚","ã‚ˆã‚ã—ãã§ã™ã€‚"],
      soft:["è¨±ã—ã¦â€¦ï¼","æ¬¡ã¯ã†ã¾ãã‚„ã‚‹â€¦ï¼","ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™â€¦ï¼"]
    };

    const $ = (id) => document.getElementById(id);

    let seed = (Date.now() ^ (Math.random() * 1e9)) >>> 0;
    let rng = mulberry32(seed);

    const state = { situation:"â€”", apology:"â€”" };

    function buildApology(situation){
      const tone = pick(rng, TONE);
      const level = pick(rng, LEVEL);

      const o = pick(rng, OPEN[tone]);
      const b = pick(rng, BODY[tone][level]);
      const f = pick(rng, FIX[tone]);
      const c = pick(rng, CLOSE[tone]);

      // â€œãã‚Œã£ã½ã•â€ã¯æ®‹ã™ãŒã€ç‰¹å®šã®æ¥­å‹™èªå½™ã¯å‡ºã•ãªã„
      return `${o}

ã€çŠ¶æ³ã€‘${situation}

${b}
${f}

${c}`;
    }

    function render(){
      $("seedPill").textContent = `seed: ${seed}`;
      $("scenarioText").textContent = state.situation;
      $("apologyText").textContent = state.apology;
    }

    function regenerate(){
      seed = (Date.now() ^ (Math.random() * 1e9)) >>> 0;
      rng = mulberry32(seed);

      state.situation = pick(rng, SITUATIONS);
      state.apology = buildApology(state.situation);
      render();
    }

    // Image
    const img = $("sorryImg");
    const imgFallback = $("imgFallback");
    img.src = asset("./assets/matsumura_sorry.png");
    img.addEventListener("error", () => {
      imgFallback.hidden = false;
      img.style.display = "none";
    });

    // Toast
    const elToast = $("toast");
    function toast(msg){
      elToast.textContent = msg;
      elToast.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(()=> elToast.classList.remove("show"), 900);
    }

    // Copy / Share
    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
      }
    }

    $("btnGenerate").addEventListener("click", regenerate);
    $("btnCopy").addEventListener("click", ()=> copyText(state.apology));
    $("btnCopyAll").addEventListener("click", ()=> {
      const all = `ã€ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã€‘\n${state.situation}\n\nã€ãŠè©«ã³æ–‡ã€‘\n${state.apology}`;
      copyText(all);
    });
    $("btnShare").addEventListener("click", async ()=>{
      const text = `ã€ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã€‘\n${state.situation}\n\nã€ãŠè©«ã³æ–‡ã€‘\n${state.apology}`;
      if(navigator.share){
        try{ await navigator.share({ title:"ãŠè©«ã³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼", text }); }catch(e){}
      }else{
        toast("å…±æœ‰ã¯æœªå¯¾å¿œã§ã™");
      }
    });

    regenerate();
  </script>
</body>
</html>

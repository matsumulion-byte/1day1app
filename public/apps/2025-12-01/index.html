<!doctype html>
<html lang="ja">
<head>
  <!-- OGP AUTO-GENERATED START (do not edit by hand) -->
  <meta property="og:title" content="å¸«èµ°ãƒ€ãƒƒã‚·ãƒ¥æ¾æ‘">
  <meta name="twitter:title" content="å¸«èµ°ãƒ€ãƒƒã‚·ãƒ¥æ¾æ‘">
  <meta property="og:description" content="SCORE 0 BEST 0 å¸«èµ°ãƒ€ãƒƒã‚·ãƒ¥æ¾æ‘ ã‚¸ãƒ£ãƒ³ãƒ—ã§éšœå®³ç‰©ã‚’é¿ã‘ç¶šã‘ã‚‹ã€ ç„¡é™ãƒ©ãƒ³ã‚²ãƒ¼ãƒ ã€‚ ã©ã‚Œã ã‘èµ°ã‚Šåˆ‡ã‚Œã‚‹ã‹ã€ å¸«èµ°ã®è¡—ã‚’é§†ã‘æŠœã‘ã‚ã€‚ ã‚¹ã‚¿ãƒ¼ãƒˆ ã‚¹ãƒãƒ›ï¼šç”»é¢ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ— PCï¼šã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ / â†‘ã‚­ãƒ¼ã§ã‚¸ãƒ£ãƒ³ãƒ— ä»Šå›ã®ã‚¹ã‚³ã‚¢ 0 ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢ï¼š 0 ã‚‚ã†ä¸€åº¦ å¸«èµ°">
  <meta name="twitter:description" content="SCORE 0 BEST 0 å¸«èµ°ãƒ€ãƒƒã‚·ãƒ¥æ¾æ‘ ã‚¸ãƒ£ãƒ³ãƒ—ã§éšœå®³ç‰©ã‚’é¿ã‘ç¶šã‘ã‚‹ã€ ç„¡é™ãƒ©ãƒ³ã‚²ãƒ¼ãƒ ã€‚ ã©ã‚Œã ã‘èµ°ã‚Šåˆ‡ã‚Œã‚‹ã‹ã€ å¸«èµ°ã®è¡—ã‚’é§†ã‘æŠœã‘ã‚ã€‚ ã‚¹ã‚¿ãƒ¼ãƒˆ ã‚¹ãƒãƒ›ï¼šç”»é¢ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ— PCï¼šã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ / â†‘ã‚­ãƒ¼ã§ã‚¸ãƒ£ãƒ³ãƒ— ä»Šå›ã®ã‚¹ã‚³ã‚¢ 0 ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢ï¼š 0 ã‚‚ã†ä¸€åº¦ å¸«èµ°">
  <meta property="og:image" content="/2025-12-01/assets/bg.png">
  <meta name="twitter:image" content="/2025-12-01/assets/bg.png">
  <meta property="og:url" content="/2025-12-01/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <!-- OGP AUTO-GENERATED END -->

<meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"
  />
  <title>å¸«èµ°ãƒ€ãƒƒã‚·ãƒ¥æ¾æ‘</title>

  <style>
    :root {
      --bg: #020617;
      --bg-soft: #0b1120;
      --accent: #f97316;
      --ink: #f9fafb;
      --muted: #9ca3af;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 60%);
      color: var(--ink);
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .app {
      position: relative;
      width: 100vw;
      height: 100vh;
      max-width: 480px;
      margin: 0 auto;
      overflow: hidden;
      background: radial-gradient(circle at top, #020617 0, #000 70%);
    }

    canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      background:
        linear-gradient(to top, #020617 0%, #020617 35%, #020617 40%, #020617 100%);
    }

    .ui-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .hud {
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--ink);
      text-shadow: 0 2px 8px rgba(0,0,0,0.8);
    }

    .hud-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.7);
      border: 1px solid rgba(148,163,184,0.7);
      pointer-events: auto;
    }

    .center-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 14px;
      text-align: center;
      pointer-events: auto;
      background: radial-gradient(circle at top, rgba(15,23,42,0.9) 0, rgba(15,23,42,0.9) 40%, rgba(15,23,42,0.8) 60%, rgba(15,23,42,0.6) 100%);
    }

    .hidden {
      display: none;
    }

    h1 {
      font-size: 20px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .subtitle {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.6;
    }

    .btn {
      appearance: none;
      border: none;
      outline: none;
      padding: 10px 18px;
      border-radius: 999px;
      background: var(--accent);
      color: #111827;
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      box-shadow: 0 10px 25px rgba(249, 115, 22, 0.4);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.5);
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
    }

    .result-score {
      font-size: 32px;
      font-weight: 800;
    }

    .result-label {
      font-size: 13px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="app">
    <canvas id="game"></canvas>

    <div class="ui-layer">
      <div class="hud">
        <div class="hud-pill">SCORE <span id="hud-score">0</span></div>
        <div class="hud-pill">BEST <span id="hud-best">0</span></div>
      </div>

      <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
      <div id="overlay-start" class="center-overlay">
        <h1>å¸«èµ°ãƒ€ãƒƒã‚·ãƒ¥æ¾æ‘</h1>
        <p class="subtitle">
          ã‚¸ãƒ£ãƒ³ãƒ—ã§éšœå®³ç‰©ã‚’é¿ã‘ç¶šã‘ã‚‹ã€<br />
          ç„¡é™ãƒ©ãƒ³ã‚²ãƒ¼ãƒ ã€‚<br />
          ã©ã‚Œã ã‘èµ°ã‚Šåˆ‡ã‚Œã‚‹ã‹ã€<br />
          å¸«èµ°ã®è¡—ã‚’é§†ã‘æŠœã‘ã‚ã€‚
        </p>
        <button id="btn-start" class="btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <p class="hint">
          ã‚¹ãƒãƒ›ï¼šç”»é¢ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ—<br />
          PCï¼šã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ / â†‘ã‚­ãƒ¼ã§ã‚¸ãƒ£ãƒ³ãƒ—
        </p>
      </div>

      <!-- ãƒªã‚¶ãƒ«ãƒˆç”»é¢ -->
      <div id="overlay-result" class="center-overlay hidden">
        <div class="result-label">ä»Šå›ã®ã‚¹ã‚³ã‚¢</div>
        <div id="result-score" class="result-score">0</div>
        <div class="result-label">ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢ï¼š<span id="result-best">0</span></div>
        <p id="result-comment" class="subtitle"></p>
        <button id="btn-retry" class="btn">ã‚‚ã†ä¸€åº¦</button>
        <p class="hint">
          å¸«èµ°ã¯ã¾ã çµ‚ã‚ã‚‰ãªã„ã€‚<br />
          ä½•å›ã§ã‚‚èµ°ã‚Œã¾ã™ã€‚
        </p>
      </div>
    </div>
  </div>

  <script type="module">
    // ============================
    // ã‚¢ã‚»ãƒƒãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆVercelå¯¾å¿œï¼‰
    // ============================
    const DATE_SEGMENT = (location.pathname.match(/\d{4}-\d{2}-\d{2}/) || [""])[0];
    const DATE_BASE = DATE_SEGMENT ? `/${DATE_SEGMENT}/` : "/";
    const asset = (p = "") => {
      const clean = String(p).replace(/^\.?\//, "");
      return `${DATE_BASE}${clean}`;
    };

    // ====== DOM ======
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const hudScore = document.getElementById("hud-score");
    const hudBest  = document.getElementById("hud-best");

    const overlayStart  = document.getElementById("overlay-start");
    const overlayResult = document.getElementById("overlay-result");
    const btnStart = document.getElementById("btn-start");
    const btnRetry = document.getElementById("btn-retry");

    const resultScore   = document.getElementById("result-score");
    const resultBest    = document.getElementById("result-best");
    const resultComment = document.getElementById("result-comment");

    // ====== BGMè¨­å®šï¼ˆ3:17ã®æ›²ï¼‰ ======
    const bgm = new Audio(asset("./assets/bgm.mp3"));
    bgm.loop = false;       // æ›²ãŒçµ‚ã‚ã£ãŸã‚‰æ­¢ã‚ã‚‹
    bgm.volume = 0.8;
    let bgmStarted = false;

    bgm.onended = () => {
      // æ›²ã‚’å®Œèµ°ã—ãŸã‚‰ã‚´ãƒ¼ãƒ«
      if (running) {
        gameClear();
      }
    };

    function playBgm() {
      bgm.currentTime = 0;
      bgmStarted = true;
      bgm.play().catch(() => {
        // è‡ªå‹•å†ç”Ÿãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸã‚‰ç„¡è¦–
      });
    }

    // ====== ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆè¨­å®š ======
    const spriteImage = new Image();
    spriteImage.src = asset("./assets/matsu_run.png"); // æ¨ª5Ã—ç¸¦6ã®ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆ
    let spriteLoaded = false;
    spriteImage.onload = () => { spriteLoaded = true; };

    const SPRITE_COLS = 5;         // æ¨ª5ã‚³ãƒ
    const SPRITE_ROWS = 6;         // ç¸¦6ã‚³ãƒ
    const SPRITE_FRAME_COUNT = SPRITE_COLS * SPRITE_ROWS; // = 30

    function getFrameSize() {
      const fw = spriteImage.width / SPRITE_COLS;
      const fh = spriteImage.height / SPRITE_ROWS;
      return { fw, fh };
    }

    // ====== èƒŒæ™¯ç”»åƒï¼ˆæ–°å®¿ã‚¤ãƒ«ãƒŸï¼‰ ======
    const bgImage = new Image();
    bgImage.src = asset("./assets/bg.png");
    let bgReady = false;
    bgImage.onload = () => { bgReady = true; };

    let bgScrollX = 0;

    // ====== ã‚²ãƒ¼ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ======
    let dpr = window.devicePixelRatio || 1;
    let viewWidth = 0;
    let viewHeight = 0;

    function resize() {
      dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      viewWidth  = rect.width;
      viewHeight = rect.height;

      canvas.width  = viewWidth * dpr;
      canvas.height = viewHeight * dpr;
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener("resize", resize);
    resize();

    // ç‰©ç†ãƒ»ãƒ¬ãƒ¼ãƒ³
    let groundY = 0;
    function updateGroundY() {
      groundY = viewHeight * 0.78; // ç”»é¢ä¸‹ã®æ–¹ã«åœ°é¢
    }
    updateGroundY();

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
    const player = {
      x: 0,
      y: 0,
      vy: 0,
      width: 80,
      height: 120,
      onGround: false,
      frameIndex: 0,
      frameTime: 0
    };

    // éšœå®³ç‰©
    const obstacles = [];
    let obstacleTimer = 0;

    // ã‚¹ã‚³ã‚¢
    let score = 0;
    let bestScore = Number(localStorage.getItem("shiwase_best") || "0");

    // çŠ¶æ…‹
    let running = false;
    let lastTime = 0;

    // ====== ã‚²ãƒ¼ãƒ åˆæœŸåŒ– ======
    function resetGame() {
      resize();
      updateGroundY();

      player.x = viewWidth * 0.22;
      player.y = groundY;
      player.vy = 0;
      player.onGround = true;
      player.frameIndex = 0;
      player.frameTime = 0;

      obstacles.length = 0;
      obstacleTimer = 0;
      score = 0;
      hudScore.textContent = "0";
      hudBest.textContent = String(bestScore);

      bgScrollX = 0;
    }

    // ====== ã‚¸ãƒ£ãƒ³ãƒ—å‡¦ç† ======
    const GRAVITY = 0.7;
    const JUMP_VELOCITY = -14;

    function jump() {
      if (!running) return;
      if (!player.onGround) return;
      player.vy = JUMP_VELOCITY;
      player.onGround = false;
    }

    // ====== å…¥åŠ› ======
    canvas.addEventListener("touchstart", (e) => {
      e.preventDefault();
      jump();
    }, { passive: false });

    canvas.addEventListener("mousedown", (e) => {
      e.preventDefault();
      jump();
    });

    window.addEventListener("keydown", (e) => {
      if (e.code === "Space" || e.code === "ArrowUp") {
        e.preventDefault();
        jump();
      }
    });

    // ====== éšœå®³ç‰©ç”Ÿæˆ ======
    function spawnObstacle() {
      const width = 40 + Math.random() * 40;
      const height = 30 + Math.random() * 40;

      obstacles.push({
        x: viewWidth + width,
        y: groundY,
        width,
        height
      });
    }

    // ====== è¡çªåˆ¤å®šï¼ˆã–ã£ãã‚ŠçŸ©å½¢ï¼‰ ======
    function checkCollision(a, b) {
      return !(
        a.x + a.width * 0.6 < b.x ||
        a.x + a.width * 0.4 > b.x + b.width ||
        a.y < b.y - b.height ||
        a.y - a.height > b.y
      );
    }

    // ====== æç”» ======
    function drawBackground(dt) {
      const w = viewWidth;
      const h = viewHeight;

      // èƒŒæ™¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      if (bgReady) {
        const imgW = bgImage.width;
        const imgH = bgImage.height;
        const scale = h / imgH;
        const drawW = imgW * scale;
        const speed = 0.8; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦

        bgScrollX -= speed * (dt / 16.67);
        const x1 = (bgScrollX % drawW);
        const x2 = x1 + drawW;

        ctx.drawImage(bgImage, x1, 0, drawW, h);
        ctx.drawImage(bgImage, x2, 0, drawW, h);
      } else {
        // ãƒ­ãƒ¼ãƒ‰å‰ã¯ã‚°ãƒ©ãƒ‡
        const grad = ctx.createLinearGradient(0, 0, 0, h);
        grad.addColorStop(0, "#020617");
        grad.addColorStop(0.5, "#020617");
        grad.addColorStop(1, "#020617");
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, w, h);
      }

      // åœ°é¢
      ctx.fillStyle = "#0f172a";
      ctx.fillRect(0, groundY, w, h - groundY);

      // ãƒ©ã‚¤ãƒ³
      ctx.strokeStyle = "#1f2937";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(0, groundY + 0.5);
      ctx.lineTo(w, groundY + 0.5);
      ctx.stroke();
    }

    function drawPlayer(dt) {
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
      player.frameTime += dt;
      const frameDuration = 1000 / 10; // 10fpsãã‚‰ã„
      if (player.frameTime >= frameDuration) {
        player.frameTime -= frameDuration;
        player.frameIndex = (player.frameIndex + 1) % SPRITE_FRAME_COUNT;
      }

      const { fw, fh } = getFrameSize();
      const col = player.frameIndex % SPRITE_COLS;
      const row = Math.floor(player.frameIndex / SPRITE_COLS);
      const sx = col * fw;
      const sy = row * fh;

      const drawW = player.width;
      const drawH = player.height;

      const dx = player.x - drawW / 2;
      const dy = player.y - drawH;

      if (spriteLoaded) {
        ctx.drawImage(spriteImage, sx, sy, fw, fh, dx, dy, drawW, drawH);
      } else {
        // ãƒ­ãƒ¼ãƒ‰å‰ã®ä»£æ›¿ï¼ˆç°¡å˜ãªå››è§’ï¼‰
        ctx.fillStyle = "#f97316";
        ctx.fillRect(dx, dy, drawW, drawH);
      }
    }

    function drawObstacles() {
      ctx.fillStyle = "#facc15";
      obstacles.forEach((ob) => {
        ctx.fillRect(ob.x - ob.width, ob.y - ob.height, ob.width, ob.height);
      });
    }

    // ====== ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— ======
    function loop(timestamp) {
      if (!lastTime) lastTime = timestamp;
      const dt = timestamp - lastTime;
      lastTime = timestamp;

      if (running) {
        update(dt);
        render(dt);
      } else {
        // åœæ­¢ä¸­ã‚‚èƒŒæ™¯ã ã‘æç”»ã—ã¦ãŠã
        render(0);
      }

      requestAnimationFrame(loop);
    }

    function update(dt) {
      const t = dt / 16.67; // 60fpsåŸºæº–ã®ä¿‚æ•°

      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç‰©ç†
      player.vy += GRAVITY * t;
      player.y += player.vy * t;

      if (player.y >= groundY) {
        player.y = groundY;
        player.vy = 0;
        player.onGround = true;
      }

      // éšœå®³ç‰©
      obstacleTimer -= dt;
      if (obstacleTimer <= 0) {
        spawnObstacle();
        const baseInterval = 1300;
        const accel = Math.max(200, baseInterval - score * 10);
        obstacleTimer = baseInterval + Math.random() * accel;
      }

      const speed = 5 + Math.min(score / 10, 8); // å¾ã€…ã«åŠ é€Ÿ
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const ob = obstacles[i];
        ob.x -= speed * t;
        if (ob.x + ob.width < 0) {
          // ç”»é¢å¤– â†’ ã‚¹ã‚³ã‚¢åŠ ç®—
          obstacles.splice(i, 1);
          score++;
          hudScore.textContent = String(score);
        }
      }

      // è¡çªåˆ¤å®š
      const playerBox = {
        x: player.x,
        y: player.y,
        width: player.width,
        height: player.height
      };
      for (const ob of obstacles) {
        const obBox = {
          x: ob.x - ob.width / 2,
          y: ob.y,
          width: ob.width,
          height: ob.height
        };
        if (checkCollision(playerBox, obBox)) {
          gameOver();
          break;
        }
      }
    }

    function render(dt) {
      drawBackground(dt);
      drawObstacles();
      drawPlayer(dt);
    }

    // ====== ã‚²ãƒ¼ãƒ é–‹å§‹ / çµ‚äº† ======
    function startGame() {
      resetGame();
      running = true;
      overlayStart.classList.add("hidden");
      overlayResult.classList.add("hidden");
      playBgm();
    }

    function finishCommon(comment) {
      if (score > bestScore) {
        bestScore = score;
        localStorage.setItem("shiwase_best", String(bestScore));
      }

      resultScore.textContent = String(score);
      resultBest.textContent  = String(bestScore);
      resultComment.textContent = comment;

      overlayResult.classList.remove("hidden");
    }

    // éšœå®³ç‰©ã«å½“ãŸã£ãŸã¨ã
    function gameOver() {
      running = false;
      bgm.pause();

      let comment = "";
      if (score >= 40) {
        comment = "å¸«èµ°ã®è¡—ã‚’å®Œå…¨ã«åˆ¶ã—ãŸæ¾æ‘ã€‚ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸã€‚";
      } else if (score >= 20) {
        comment = "ã‹ãªã‚Šã®ãƒ€ãƒƒã‚·ãƒ¥åŠ›ã€‚å¹´å†…ã«ã‚‚ã†ä¸€ä¼¸ã³ã‚ã‚Šãã†ã€‚";
      } else if (score >= 10) {
        comment = "ã„ã„ã‚¦ã‚©ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ã€‚ã‚‚ã†ä¸€èµ°ã‚Šã„ãã¾ã™ã‹ã€‚";
      } else {
        comment = "ã¾ã å§‹ã¾ã£ãŸã°ã‹ã‚Šã€‚å¸«èµ°ã¯ã“ã“ã‹ã‚‰ã§ã™ã€‚";
      }

      finishCommon(comment);
    }

    // æ›²ã‚’å®Œèµ°ã—ãŸã¨ãï¼ˆã‚´ãƒ¼ãƒ«ï¼‰
    function gameClear() {
      running = false;
      bgm.pause();

      const comment = "ğŸ‰ å®Œèµ°ãŠã‚ã§ã¨ã†ï¼3åˆ†17ç§’ã€å¸«èµ°ã‚’èµ°ã‚Šãã‚Šã¾ã—ãŸã€‚";
      finishCommon(comment);
    }

    // ====== ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ ======
    btnStart.addEventListener("click", () => {
      startGame();
    });

    btnRetry.addEventListener("click", () => {
      startGame();
    });

    // åˆæœŸæç”»
    resetGame();
    render(0);
    requestAnimationFrame(loop);
  </script>
</body>
</html>

<!doctype html>
<html lang="ja">
<head>
  <!-- OGP AUTO-GENERATED START (do not edit by hand) -->
  <meta property="og:title" content="æ¾æ‘åˆæˆãƒã‚·ãƒ¼ãƒ³">
  <meta name="twitter:title" content="æ¾æ‘åˆæˆãƒã‚·ãƒ¼ãƒ³">
  <meta property="og:description" content="æ¾æ‘åˆæˆãƒã‚·ãƒ¼ãƒ³ ãƒ™ãƒ¼ã‚¹æ¾æ‘ã«ãƒ‘ãƒ¼ãƒ„ã‚’é¸æŠ åˆæˆçµæœ Ã— åå‰ï¼šâ€” ç³»çµ±ï¼šâ€” å±æ€§ï¼šâ€” â¬‡ï¸ ç”»åƒã‚’ä¿å­˜ â†¶ å…¨éƒ¨æ¶ˆã™ ğŸ”¥ åˆæˆã™ã‚‹ ãƒ’ãƒ³ãƒˆï¼šä¸‹ã®ãƒˆãƒ¬ã‚¤ã‹ã‚‰ãƒ‘ãƒ¼ãƒ„ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚">
  <meta name="twitter:description" content="æ¾æ‘åˆæˆãƒã‚·ãƒ¼ãƒ³ ãƒ™ãƒ¼ã‚¹æ¾æ‘ã«ãƒ‘ãƒ¼ãƒ„ã‚’é¸æŠ åˆæˆçµæœ Ã— åå‰ï¼šâ€” ç³»çµ±ï¼šâ€” å±æ€§ï¼šâ€” â¬‡ï¸ ç”»åƒã‚’ä¿å­˜ â†¶ å…¨éƒ¨æ¶ˆã™ ğŸ”¥ åˆæˆã™ã‚‹ ãƒ’ãƒ³ãƒˆï¼šä¸‹ã®ãƒˆãƒ¬ã‚¤ã‹ã‚‰ãƒ‘ãƒ¼ãƒ„ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚">
  <meta property="og:image" content="/apps/2025-11-07/assets/fire.png">
  <meta name="twitter:image" content="/apps/2025-11-07/assets/fire.png">
  <meta property="og:url" content="/apps/2025-11-07/index.html">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <!-- OGP AUTO-GENERATED END -->

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
<title>æ¾æ‘åˆæˆãƒã‚·ãƒ¼ãƒ³</title>
<style>
  :root{
    --bg:#0b1014; --ink:#e9f1f7; --muted:#9fb0c0; --acc:#ffd36e; --rail:#14202e;
    --panel:#0f1621; --danger:#ff6b7a; --shadow:0 12px 30px rgba(0,0,0,.35);
    --safe-top: env(safe-area-inset-top, 0px); --safe-bottom: env(safe-area-inset-bottom, 0px);
    /* ãƒ—ãƒ¬ã‚¤ã‚¨ãƒªã‚¢ã®å†…å´ä½™ç™½ï¼ˆSPã¨PCã§è‡ªå‹•èª¿æ•´ï¼‰ */
    --pad: clamp(16px, 6vmin, 56px);
  }
  @media (min-width: 860px){
    :root{ --pad: clamp(24px, 5vmin, 72px); }
  }

  *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; -webkit-touch-callout:none }
  html,body{ height:100%; margin:0; background:var(--bg); color:var(--ink);
    font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif }
  body{ display:grid; grid-template-rows:auto 1fr auto; }

  header{
    padding: calc(10px + var(--safe-top)) 14px 10px;
    display:flex; align-items:center; gap:10px;
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,0));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  header h1{ font-size:16px; margin:0 }
  header .sub{ font-size:12px; color:var(--muted) }

  main{ overflow:auto; max-width:960px; margin:0 auto; padding:16px 12px 100px; }
  .card{ background:var(--panel); border:1px solid rgba(255,255,255,.06);
    border-radius:16px; box-shadow:var(--shadow); margin-bottom:16px; overflow:hidden }
  .card h2{ margin:0; padding:12px 16px; font-size:14px; color:var(--muted);
    border-bottom:1px solid rgba(255,255,255,.06) }
  .area{ position:relative; aspect-ratio:1/2; }
  #stage{ padding:16px; display:flex; flex-direction:column; gap:12px; height:100%; }

  /* ä¸Šä¸‹åˆ†å‰²ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆSPï¼‰ */
  #base{ position:relative; flex:1; width:100%; display:flex; align-items:center; justify-content:center;
    background:rgba(255,255,255,.02); border-radius:12px; overflow:hidden; min-height:0; }
  #baseImg{
    width:100%; height:100%; object-fit:contain; pointer-events:none;
    filter:drop-shadow(0 8px 24px rgba(0,0,0,.45));
  }

  #play{ position:relative; flex:1; width:100%; display:flex; align-items:center; justify-content:center;
    background:rgba(255,255,255,.02); border-radius:12px; overflow:hidden; min-height:0; }
  #play.empty{ border:2px dashed rgba(255,255,255,.15); }
  #play.empty::after{ content:'ãƒ‘ãƒ¼ãƒ„ã‚’é¸æŠ'; color:var(--muted); font-size:14px; }

  /* PCã¯å·¦å³ã«ä¸¦ã¶ */
  @media (min-width: 860px){
    .area{ aspect-ratio:2/1; }
    #stage{ flex-direction:row; }
    #base{ width:auto; height:100%; }
    #play{ width:auto; height:100%; }
  }

  .part{
    width:80%; height:80%; object-fit:contain; filter:drop-shadow(0 8px 24px rgba(0,0,0,.55));
    animation:fade-in 0.3s ease-out;
  }
  @keyframes fade-in { from{opacity:0; transform:scale(0.9)} to{opacity:1; transform:scale(1)} }

  .meta{ padding:12px 16px; font-size:13px; color:var(--muted); display:flex; gap:8px; flex-wrap:wrap }
  .badge{ display:inline-block; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.1);
          padding:6px 12px; border-radius:999px; font-size:12px }

  /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
  .modal{ position:fixed; inset:0; z-index:100; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,.85); backdrop-filter:blur(8px); padding:20px; }
  .modal.active{ display:flex; }
  .modal-content{ background:var(--panel); border:1px solid rgba(255,255,255,.1);
    border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,.6); max-width:90vw; max-height:90vh;
    display:flex; flex-direction:column; overflow:hidden; }
  .modal-header{ padding:16px 20px; border-bottom:1px solid rgba(255,255,255,.06);
    display:flex; align-items:center; justify-content:space-between; }
  .modal-header h3{ margin:0; font-size:16px; color:var(--ink); }
  .modal-close{ width:32px; height:32px; border:none; background:transparent; color:var(--muted);
    font-size:24px; cursor:pointer; display:grid; place-items:center; border-radius:8px;
    transition:background .2s, color .2s; }
  .modal-close:hover{ background:rgba(255,255,255,.1); color:var(--ink); }
  .modal-body{ padding:20px; overflow:auto; flex:1; display:flex; flex-direction:column; gap:16px; }
  .modal-image{ width:100%; max-width:600px; margin:0 auto; border-radius:12px; overflow:hidden;
    background:#000; }
  .modal-image canvas{ width:100%; height:auto; display:block; }
  .modal-meta{ display:flex; flex-direction:column; gap:12px; }
  .modal-actions{ display:flex; gap:10px; padding-top:8px; }
  .modal-actions .btn{ flex:1; }

  .dock{
    position:sticky; bottom:0; z-index:50;
    padding:10px 10px calc(10px + var(--safe-bottom));
    background:linear-gradient(0deg, rgba(10,14,20,.95), rgba(10,14,20,.7) 50%, rgba(10,14,20,0));
    backdrop-filter:saturate(1.2) blur(6px);
    border-top:1px solid rgba(255,255,255,.08);
  }
  .tray{
    display:flex; gap:10px; overflow:auto; padding:6px 2px 10px;
    scroll-snap-type:x mandatory;
  }
  .tray::-webkit-scrollbar{ display:none }
  .chip{
    flex:0 0 auto; width:72px; scroll-snap-align:center;
    background:var(--rail); border:1px solid rgba(255,255,255,.08);
    border-radius:14px; padding:8px 6px; display:grid; place-items:center; gap:4px;
    color:var(--ink); font-size:11px; line-height:1.1;
  }
  .chip img{ width:100%; aspect-ratio:1/1; object-fit:contain }
  .dock-actions{ display:flex; gap:10px; margin-top:8px }
  .btn{
    flex:1; appearance:none; border:none; border-radius:14px; padding:14px 16px; font-weight:800; font-size:15px;
    background:var(--acc); color:#1b1300; box-shadow:0 8px 18px rgba(0,0,0,.35);
  }
  .btn.secondary{ flex:0 0 auto; min-width:44px; padding:12px 14px; background:#223045; color:var(--ink) }

  footer{ padding:10px 14px; color:var(--muted); font-size:12px; }

  .fx{ position:absolute; inset:0; border-radius:12px; pointer-events:none; opacity:0 }
  .flash{ background:radial-gradient(60% 60% at 50% 50%, rgba(255,220,120,.65), rgba(255,220,120,0) 60%) }
  .smoke{ background:radial-gradient(70% 70% at 50% 50%, rgba(180,180,180,.35), rgba(180,180,180,0) 60%); filter:blur(2px) }
  @keyframes fx-pop { 0%{opacity:0} 12%{opacity:1} 70%{opacity:.85} 100%{opacity:0} }
  .play{ animation: fx-pop 750ms ease-out forwards }
  @keyframes modal-fade-in { from{opacity:0; transform:scale(0.95)} to{opacity:1; transform:scale(1)} }
  .modal.active .modal-content{ animation:modal-fade-in 0.3s ease-out; }
</style>
</head>
<body>
  <header>
    <h1>æ¾æ‘åˆæˆãƒã‚·ãƒ¼ãƒ³</h1>
  </header>

  <main>
    <section class="card">
      <h2>ãƒ™ãƒ¼ã‚¹æ¾æ‘ã«ãƒ‘ãƒ¼ãƒ„ã‚’é¸æŠ</h2>
      <div id="stage" class="area">
        <div id="base">
          <img id="baseImg" alt="æ¾æ‘" />
        </div>
        <div id="play" class="empty">
          <!-- é¸æŠã•ã‚ŒãŸãƒ‘ãƒ¼ãƒ„ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
      </div>
    </section>
  </main>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="resultModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>åˆæˆçµæœ</h3>
        <button class="modal-close" id="modalClose" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="modal-image">
          <canvas id="resultCanvas" width="1024" height="1024"></canvas>
          <div id="fxFlash" class="fx flash"></div>
          <div id="fxSmoke" class="fx smoke"></div>
        </div>
        <div class="modal-meta">
          <div class="meta">
            <span class="badge" id="resultName">åå‰ï¼šâ€”</span>
            <span class="badge" id="resultType">ç³»çµ±ï¼šâ€”</span>
            <span class="badge" id="resultAttr">å±æ€§ï¼šâ€”</span>
          </div>
          <div class="modal-actions">
            <a id="dl" class="btn" download="matsumix.png">â¬‡ï¸ ç”»åƒã‚’ä¿å­˜</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dock">
    <div class="tray" id="tray" aria-label="ç´ æãƒˆãƒ¬ã‚¤ï¼ˆæ¨ªã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰"></div>
    <div class="dock-actions">
      <button class="btn secondary" id="undoOne" title="ã²ã¨ã¤æˆ»ã™">â†¶</button>
      <button class="btn secondary" id="clearParts" title="å…¨éƒ¨æ¶ˆã™">å…¨éƒ¨æ¶ˆã™</button>
      <button class="btn" id="synthesizeBtn">ğŸ”¥ åˆæˆã™ã‚‹</button>
    </div>
  </div>

  <footer>ãƒ’ãƒ³ãƒˆï¼šä¸‹ã®ãƒˆãƒ¬ã‚¤ã‹ã‚‰ãƒ‘ãƒ¼ãƒ„ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚</footer>

<script type="module">
  // Vercelç”¨ã®ãƒ‘ã‚¹è§£æ±º
  const DATE_SEGMENT = (location.pathname.match(/\d{4}-\d{2}-\d{2}/) || [""])[0];
  const DATE_BASE = DATE_SEGMENT ? `/${DATE_SEGMENT}/` : '/';
  const asset = (p) => {
    const clean = String(p || '').replace(/^\.?\//, '');
    return `${DATE_BASE}${clean}`;
  };

  const PARTS = [
    { id:'lion',  label:'ãƒ©ã‚¤ã‚ªãƒ³', src:asset('assets/lion.png'),  baseName:'ãƒ©ã‚¤ã‚ªãƒ³', attr:'ç£' },
    { id:'horse', label:'é¦¬',       src:asset('assets/horse.png'), baseName:'ãƒ›ãƒ¼ã‚¹',   attr:'ä¿Šè¶³' },
    { id:'stone', label:'çŸ³',       src:asset('assets/stone.png'), baseName:'ã‚¹ãƒˆãƒ¼ãƒ³', attr:'ç¡¬è³ª' },
    { id:'fire',  label:'ç‚',       src:asset('assets/fire.png'),  baseName:'ãƒ•ã‚¡ã‚¤ã‚¢', attr:'ç‚' },
  ];
  const BASE_IMG = asset('assets/matsumura.png');

  const RESULT_IMAGES = {
    lion:  { cool: asset('assets/results/lion_cool.png'),  weird: asset('assets/results/lion_weird.png') },
    horse: { cool: asset('assets/results/horse_cool.png'), weird: asset('assets/results/horse_weird.png') },
    stone: { cool: asset('assets/results/stone_cool.png'), weird: asset('assets/results/stone_weird.png') },
    fire:  { cool: asset('assets/results/fire_cool.png'),  weird: asset('assets/results/fire_weird.png') },
  };

  const RESULTS = {
    lion:  { cool:{name:'ãƒãƒ„ãƒ ãƒ©ã‚¤ã‚ªãƒ³',desc:'ç™¾ç£ã®ç‹ã¨åŒ–ã—ãŸæ¾æ‘ã€‚é¦–å‘¨ã‚ŠãŒã‚ã£ãŸã‹ã„',attr:'ç£ / ç‚'},
             weird:{name:'ãƒ©ã‚¤ã‚ªãƒ³é¡”ã¯ã‚ãƒãƒ„ãƒ ãƒ©',desc:'ãƒ©ã‚¤ã‚ªãƒ³ã«é¡”ã¯ã‚ã—ãŸæ¾æ‘',attr:'ãŠã˜ã•ã‚“'} },
    horse: { cool:{name:'ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹ãƒãƒ„ãƒ ãƒ©',desc:'ã¡ã‚‡ã£ã¨ãƒãƒ©ãƒ³ã‚¹æ‚ªã„ã‘ã©ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹ã€‚è¶³ãŒ4æœ¬ã€‚',attr:'ä¿Šè¶³ / å‹¢ã„'},
             weird:{name:'ãƒ›ãƒœã‚¦ãƒ',desc:'ã‚µãƒƒã‚¯ã‚¹ãŒã¶ã‚‰ä¸‹ãŒã£ã¦ã‚‹é¦¬â€ã€‚',attr:'ã‚µãƒƒã‚¯ã‚¹'} },
    stone: { cool:{name:'ãƒãƒ„ãƒ ãƒ©ãƒ­ãƒƒã‚¯',desc:'å‹•ã‹ã–ã‚‹æ¾æ‘ã€‚æ„å¿—ãŒå²©ã‚ˆã‚Šå›ºã„ã€‚',attr:'é˜²å¾¡ / å®‰å®š'},
             weird:{name:'æ¾æ‘å²©',desc:'è¦³å…‰åæ‰€ã«ãªã‚Šã¤ã¤ã‚ã‚‹ã€‚',attr:'å²©'} },
    fire:  { cool:{name:'ãƒãƒ„ãƒ ãƒ©ãƒ•ã‚¡ã‚¤ã‚¢',desc:'æƒ…ç†±ã§ä¼ç”»ã‚’ç‡ƒã‚„ã—å°½ãã™ã€‚',attr:'ç‚ / æ”»æ’ƒ'},
             weird:{name:'ã‚³ã‚²ãƒãƒ„ãƒ ãƒ©',desc:'ã¡ã‚‡ã£ã¨ã‚³ã‚²ã¡ã‚ƒã£ãŸ',attr:'æš´èµ°'} },
  };

  // DOM
  const tray = document.getElementById('tray');
  const base = document.getElementById('base');
  const play = document.getElementById('play');        // â˜…å†…å´ãƒ—ãƒ¬ã‚¤ã‚¨ãƒªã‚¢
  const baseImg = document.getElementById('baseImg');
  const synthBtn = document.getElementById('synthesizeBtn');
  const clearBtn = document.getElementById('clearParts');
  const undoBtn = document.getElementById('undoOne');
  const resultCanvas = document.getElementById('resultCanvas');
  const resultName = document.getElementById('resultName');
  const resultType = document.getElementById('resultType');
  const resultAttr = document.getElementById('resultAttr');
  const fxFlash = document.getElementById('fxFlash');
  const fxSmoke = document.getElementById('fxSmoke');
  const dl = document.getElementById('dl');
  const resultModal = document.getElementById('resultModal');
  const modalClose = document.getElementById('modalClose');

  baseImg.src = BASE_IMG;

  // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—æ‹¡å¤§æŠ‘åˆ¶
  let lastTouch = 0;
  document.addEventListener('touchend', e=>{
    const now = Date.now();
    if(now - lastTouch < 400) e.preventDefault();
    lastTouch = now;
  }, {passive:false});

  // ãƒˆãƒ¬ã‚¤
  PARTS.forEach(p=>{
    const b = document.createElement('button');
    b.className = 'chip';
    b.innerHTML = `<img alt="${p.label}" src="${p.src}"><div>${p.label}</div>`;
    b.addEventListener('click', ()=>spawnPart(p));
    tray.appendChild(b);
  });

  // é¸æŠã•ã‚ŒãŸãƒ‘ãƒ¼ãƒ„
  const placed = []; // {el, part}
  let currentPart = null; // ç¾åœ¨é¸æŠä¸­ã®ãƒ‘ãƒ¼ãƒ„

  function spawnPart(part){
    // æ—¢å­˜ã®ãƒ‘ãƒ¼ãƒ„ã‚’å‰Šé™¤
    if(currentPart){
      const existing = play.querySelector('.part');
      if(existing) existing.remove();
    }

    // æ–°ã—ã„ãƒ‘ãƒ¼ãƒ„ç”»åƒã‚’ä½œæˆ
    const img = document.createElement('img');
    img.className = 'part';
    img.src = part.src;
    img.alt = part.label;

    // ãƒ—ãƒ¬ã‚¤ã‚¨ãƒªã‚¢ã«è¿½åŠ 
    play.innerHTML = '';
    play.appendChild(img);
    play.classList.remove('empty');

    // ç¾åœ¨ã®ãƒ‘ãƒ¼ãƒ„ã‚’æ›´æ–°
    currentPart = { el: img, part };
    placed.length = 0; // é…åˆ—ã‚’ãƒªã‚»ãƒƒãƒˆ
    placed.push(currentPart);

    navigator.vibrate?.(10);
  }

  clearBtn.addEventListener('click', ()=>{
    play.innerHTML = '';
    play.classList.add('empty');
    currentPart = null;
    placed.length = 0;
    navigator.vibrate?.(10);
  });
  
  undoBtn.addEventListener('click', ()=>{
    if(currentPart){
      play.innerHTML = '';
      play.classList.add('empty');
      currentPart = null;
      placed.length = 0;
      navigator.vibrate?.(10);
    }
  });

  const audioMatsumura = new Audio(asset('assets/matsumura_desu.m4a'));
  audioMatsumura.volume = 0.9;
  const safePlay = (a)=>{ try{ a.currentTime=0; a.play(); }catch{} };

  // ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
  modalClose.addEventListener('click', ()=> resultModal.classList.remove('active'));
  resultModal.addEventListener('click', (e)=> {
    if(e.target === resultModal) resultModal.classList.remove('active');
  });
  document.addEventListener('keydown', (e)=> {
    if(e.key === 'Escape' && resultModal.classList.contains('active')) {
      resultModal.classList.remove('active');
    }
  });

  document.getElementById('synthesizeBtn').addEventListener('click', synthesize);

  async function synthesize(){
    const ctx = resultCanvas.getContext('2d');
    const W = resultCanvas.width, H = resultCanvas.height;
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,W,H);

    const main = placed.length ? placed[0].part.id : null;
    let type = Math.random()<0.5 ? 'cool' : 'weird';

    // å®Œæˆç”»åƒï¼ˆã‚ã‚Œã°ï¼‰å„ªå…ˆ
    let drew=false;
    if(main && RESULT_IMAGES[main] && RESULT_IMAGES[main][type]){
      const img = await tryLoad(RESULT_IMAGES[main][type]);
      if(img){ drawContain(ctx, img, W, H); drew=true; }
    }
    // ç„¡ã‘ã‚Œã°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯åˆæˆï¼ˆå·¦å³ã«ä¸¦ã¹ã¦æç”»ï¼‰
    if(!drew){
      const baseImage = await loadImg(BASE_IMG);
      const partImage = placed.length ? await loadImg(placed[0].part.src) : null;
      
      // å·¦åŠåˆ†ã«ãƒ™ãƒ¼ã‚¹ç”»åƒ
      const leftW = W / 2;
      drawContain(ctx, baseImage, leftW, H, 0, 0);
      
      // å³åŠåˆ†ã«ãƒ‘ãƒ¼ãƒ„ç”»åƒ
      if(partImage){
        drawContain(ctx, partImage, leftW, H, leftW, 0);
      }
    }

    safePlay(audioMatsumura);
    if(type==='cool'){ triggerFX(fxFlash); } else { triggerFX(fxSmoke); }

    let name='æ¾æ‘ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ³ï¼‰', attr='â€”', kind='â€”';
    if(main && RESULTS[main]){
      const r = RESULTS[main][type];
      name = r.name; attr = r.attr; kind = (type==='cool'?'COOL':'WEIRD');
    }
    resultName.textContent = `åå‰ï¼š${name}`;
    resultType.textContent = `ç³»çµ±ï¼š${kind}`;
    resultAttr.textContent = `å±æ€§ï¼š${attr}`;

    dl.href = resultCanvas.toDataURL('image/png');
    navigator.vibrate?.([15,40,10]);
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    resultModal.classList.add('active');
  }

  function triggerFX(node){ node.classList.remove('play'); void node.offsetWidth; node.classList.add('play'); }

  function loadImg(src){
    return new Promise((res,rej)=>{
      const i = new Image(); i.crossOrigin='anonymous';
      i.onload = ()=>res(i); i.onerror = rej; i.src = src;
    });
  }
  function tryLoad(src){
    return new Promise((res)=>{
      const i = new Image(); i.crossOrigin='anonymous';
      i.onload = ()=>res(i); i.onerror = ()=>res(null); i.src = src;
    });
  }
  function drawContain(ctx, img, W, H, offsetX=0, offsetY=0){
    if(!img || !img.width) return;
    const ir = img.width/img.height, cr = W/H;
    let dw, dh; if(ir>cr){ dw=W; dh=W/ir } else { dh=H; dw=H*ir }
    const dx=offsetX + (W-dw)/2, dy=offsetY + (H-dh)/2;
    ctx.drawImage(img, dx, dy, dw, dh);
  }
</script>
</body>
</html>

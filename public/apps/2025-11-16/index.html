<!doctype html>
<html lang="ja">
<head>
  <!-- OGP AUTO-GENERATED START (do not edit by hand) -->
  <meta property="og:title" content="松村びっくりミラー">
  <meta name="twitter:title" content="松村びっくりミラー">
  <meta property="og:description" content="松村びっくりミラー 1DAY1APP / 2025-11-16 LIVE FACE DISTORTION -- fps カメラを許可して、顔を映してね。 顔を 左右・上下 に大きく動かすと世界が歪むよ！ 初期化中…">
  <meta name="twitter:description" content="松村びっくりミラー 1DAY1APP / 2025-11-16 LIVE FACE DISTORTION -- fps カメラを許可して、顔を映してね。 顔を 左右・上下 に大きく動かすと世界が歪むよ！ 初期化中…">
  <meta property="og:url" content="/2025-11-16/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <!-- OGP AUTO-GENERATED END -->

<meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>松村びっくりミラー</title>
  <style>
    :root {
      --bg:#05040a;
      --ink:#f5f7ff;
      --accent:#f97316;
      --accent-soft:rgba(249,115,22,0.35);
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    #dirLabel {
  display: none !important;
}
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: radial-gradient(circle at 10% 0%, #111827 0, #020617 45%, #000 100%);
      color: var(--ink);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      overscroll-behavior: none;
      touch-action: manipulation;
      -webkit-user-select: none;
      user-select: none;
    }

    body {
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    #wrap {
      position: fixed;
      inset: 0;
      padding-top: calc(8px + var(--safe-top));
      padding-bottom: calc(8px + var(--safe-bottom));
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    header {
      padding: 4px 16px 2px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      z-index: 10;
    }

    .title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.6);
      text-transform: uppercase;
      letter-spacing: .12em;
      opacity: .9;
    }

    .subtitle {
      font-size: 12px;
      opacity: .8;
    }

    main {
      flex: 1;
      min-height: 0;
      padding: 0 12px 4px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .view-shell {
      position: relative;
      flex: 1;
      min-height: 0;
      border-radius: 20px;
      overflow: hidden;
      box-shadow:
        0 18px 50px rgba(0,0,0,.75),
        0 0 0 1px rgba(15,23,42,.9);
      background:
        radial-gradient(circle at 0 0, rgba(248,250,252,.1), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(248,250,252,.05), transparent 60%),
        #020617;
    }

    .view-inner {
      position: absolute;
      inset: 0;
      overflow: hidden;
      transition:
        transform .22s ease-out,
        filter .22s ease-out;
      will-change: transform, filter;
    }

    #camera {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1);
      pointer-events: none;
    }

    .view-gradient {
      position: absolute;
      inset: 0;
      background:
        linear-gradient(to top, rgba(0,0,0,.7), transparent 45%),
        radial-gradient(circle at 10% 0%, rgba(248,250,252,.08), transparent 55%);
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .hud {
      position: absolute;
      inset: 0;
      padding: 10px 10px 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      pointer-events: none;
    }

    .badge-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      font-size: 10px;
      gap: 6px;
    }

    .badge {
      padding: 3px 8px;
      border-radius: 999px;
      backdrop-filter: blur(12px);
      background: rgba(15,23,42,.65);
      border: 1px solid rgba(148,163,184,.6);
      text-transform: uppercase;
      letter-spacing: .12em;
      opacity: .9;
      pointer-events: auto;
    }

    .badge-right {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,.8);
    }

    .dir-label-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #dirLabel {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 700;
      backdrop-filter: blur(22px);
      background: radial-gradient(circle at 10% 0%, rgba(248,250,252,.18), transparent 70%),
                  rgba(15,23,42,.88);
      box-shadow:
        0 0 30px rgba(15,23,42,.9),
        0 0 0 1px rgba(148,163,184,.7);
      text-align: center;
      min-height: 36px;
      opacity: 0;
      transform: translateY(10px) scale(.9);
      transition: opacity .2s ease-out, transform .2s ease-out;
      pointer-events: auto;
      text-shadow: 0 0 8px rgba(0,0,0,.8);
    }

    body[data-has-face="1"] #dirLabel {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    #dirLabel.flash {
      animation: pop 0.28s ease-out;
    }

    @keyframes pop {
      0%   { transform: translateY(0) scale(1); }
      40%  { transform: translateY(-3px) scale(1.12); }
      100% { transform: translateY(0) scale(1); }
    }

    footer {
      padding: 0 16px 4px;
      font-size: 11px;
      opacity: .75;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .hint {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .hint-keys {
      font-size: 10px;
      opacity: .75;
    }

    .status {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    /* ==== 方向ごとの変形（派手バージョン） ==== */

    /* 顔ナシ */
    body[data-dir="none"] .view-inner {
      transform: scale(1.0) translate3d(0,0,0);
      filter: grayscale(.8) brightness(.6) contrast(1.1);
    }

    /* ど真ん中 */
    body[data-dir="center"] .view-inner {
      transform: scale(1.06) translate3d(0,0,0);
      filter: saturate(1.4) contrast(1.1);
    }

    /* 左：ぐにゃっとワイド＆ネオン */
    body[data-dir="left"] .view-inner {
      transform: scale(1.15, 1.0) skewX(-18deg) translate3d(-14px, 0, 0);
      filter: saturate(1.8) hue-rotate(-25deg) contrast(1.35);
      animation: wobbleX 0.4s ease-in-out infinite alternate;
    }

    /* 右：反対側にぐにゃワイド */
    body[data-dir="right"] .view-inner {
      transform: scale(1.15, 1.0) skewX(18deg) translate3d(14px, 0, 0);
      filter: saturate(1.8) hue-rotate(25deg) contrast(1.35);
      animation: wobbleX 0.4s ease-in-out infinite alternate-reverse;
    }

    /* 上：完全色反転＋サイバー */
    body[data-dir="up"] .view-inner {
      transform: scale(1.12, 1.06) translate3d(0, -16px, 0);
      filter:
        invert(1)
        hue-rotate(180deg)
        saturate(2.0)
        contrast(1.5)
        brightness(1.1);
      animation: scanline 0.6s linear infinite;
    }

    /* 下：ブラー＆液体っぽい揺れ */
    body[data-dir="down"] .view-inner {
      transform: scale(1.08, 1.14) translate3d(0, 18px, 0);
      filter: blur(3px) saturate(1.3) contrast(1.1) brightness(.95);
      animation: wobbleY 0.45s ease-in-out infinite alternate;
    }

    @keyframes wobbleX {
      0%   { transform: translate3d(-6px, 0, 0) scale(1.15,1.0) skewX(-18deg); }
      100% { transform: translate3d(-18px, 0, 0) scale(1.2,1.0) skewX(-12deg); }
    }

    @keyframes wobbleY {
      0%   { transform: translate3d(0, 10px, 0) scale(1.06,1.12); }
      100% { transform: translate3d(0, 26px, 0) scale(1.1,1.18); }
    }

    @keyframes scanline {
      0% {
        filter:
          invert(1) hue-rotate(160deg)
          saturate(2.2) contrast(1.4) brightness(1.05);
      }
      100% {
        filter:
          invert(1) hue-rotate(200deg)
          saturate(2.2) contrast(1.6) brightness(1.15);
      }
    }

    /* 小さめ端末調整 */
    @media (max-width: 480px) {
      header {
        padding-inline: 12px;
      }
      main {
        padding-inline: 8px;
      }
      footer {
        padding-inline: 12px;
      }
    }
  </style>
</head>
<body data-dir="none" data-has-face="0">
<div id="wrap">
  <header>
    <div class="title">
      <span>松村びっくりミラー</span>
      <span class="title-pill">1DAY1APP / 2025-11-16</span>
    </div>
  </header>

  <main>
    <div class="view-shell">
      <div class="view-inner" id="viewInner">
        <video id="camera" autoplay playsinline muted></video>
      </div>
      <div class="view-gradient"></div>

      <div class="hud">
        <div class="badge-row">
          <div class="badge">LIVE FACE DISTORTION</div>
          <div class="badge badge-right">
            <span class="dot"></span>
            <span id="fpsText">-- fps</span>
          </div>
        </div>

        <div class="dir-label-wrap">
          <div id="dirLabel">カメラを許可して、顔を映してね。</div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="hint">
      <div>顔を <b>左右・上下</b> に大きく動かすと世界が歪むよ！</div>
    </div>
    <div class="status" id="statusText">初期化中…</div>
  </footer>
</div>

<script type="module">
  // 1day1app 共通アセットヘルパー
  const asset = (p) => new URL(p, import.meta.url).toString();

  // MediaPipe Tasks
  import vision from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3";
  const { FaceLandmarker, FilesetResolver } = vision;

  const videoEl   = document.getElementById("camera");
  const dirLabel  = document.getElementById("dirLabel");
  const statusEl  = document.getElementById("statusText");
  const fpsText   = document.getElementById("fpsText");
  const bodyEl    = document.body;

  let faceLandmarker = null;
  let lastVideoTime = -1;
  let frameCount = 0;
  let lastFpsUpdate = performance.now();
  let currentDir = "none";

  const dirMessages = {
    none: [
      "カメラを許可して、顔を映してね。",
      "画面からいなくなった…寂しい"
    ],
    center: [
      "これが基準値",
      "ナイス位置。松村ど真ん中。"
    ],
    left: [
      "右ににょーん",
      "右"
    ],
    right: [
      "松村、右にズレてるよ。",
      "そっち側、気にしすぎ松村。"
    ],
    up: [
      "上を向いても松村。",
      "そんなに見上げても松村。"
    ],
    down: [
      "下ばかり見るな松村。",
      "うつむくな松村。"
    ]
  };

  function setStatus(text) {
    if (statusEl) statusEl.textContent = text;
  }

  function pickMessage(dir) {
    const list = dirMessages[dir] || dirMessages.none;
    return list[Math.floor(Math.random() * list.length)];
  }

  function updateDirLabel(dir, hasFace) {
    if (!dirLabel) return;
    const msg = pickMessage(hasFace ? dir : "none");
    dirLabel.textContent = msg;

    // flashアニメをリスタート
    dirLabel.classList.remove("flash");
    void dirLabel.offsetWidth;
    dirLabel.classList.add("flash");
  }

  async function setupCamera() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      throw new Error("getUserMedia がサポートされていません。");
    }

    const stream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: "user",
        width: { ideal: 1280 },
        height: { ideal: 720 }
      },
      audio: false
    });
    videoEl.srcObject = stream;

    return new Promise((resolve) => {
      videoEl.onloadedmetadata = () => {
        videoEl.play();
        resolve();
      };
    });
  }

  async function createFaceLandmarker() {
    const filesetResolver = await FilesetResolver.forVisionTasks(
      "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/wasm"
    );
    faceLandmarker = await FaceLandmarker.createFromOptions(filesetResolver, {
      baseOptions: {
        modelAssetPath:
          "https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",
        delegate: "GPU"
      },
      runningMode: "VIDEO",
      numFaces: 1,
      minFaceDetectionConfidence: 0.4,
      minFacePresenceConfidence: 0.4,
      minTrackingConfidence: 0.4,
      outputFaceBlendshapes: false,
      outputFacialTransformationMatrixes: false
    });
  }

  function estimateDirectionFromLandmarks(result) {
    if (!result || !result.faceLandmarks || !result.faceLandmarks.length) {
      return { dir: "none", hasFace: false };
    }
    const points = result.faceLandmarks[0];
    let sumX = 0, sumY = 0;
    for (let i = 0; i < points.length; i++) {
      sumX += points[i].x;
      sumY += points[i].y;
    }
    const avgX = sumX / points.length; // 0(left) - 1(right)
    const avgY = sumY / points.length; // 0(top)  - 1(bottom)

    let dir = "center";

    // 横方向（少しゆるめ）
    if (avgX < 0.45) dir = "left";
    else if (avgX > 0.55) dir = "right";

    // 縦方向は優先
    if (avgY < 0.42) dir = "up";
    else if (avgY > 0.58) dir = "down";

    return { dir, hasFace: true };
  }

  function updateFps() {
    const now = performance.now();
    frameCount++;
    if (now - lastFpsUpdate >= 1000) {
      const fps = Math.round((frameCount * 1000) / (now - lastFpsUpdate));
      fpsText.textContent = fps + " fps";
      frameCount = 0;
      lastFpsUpdate = now;
    }
  }

  function renderLoop() {
    if (!faceLandmarker) {
      requestAnimationFrame(renderLoop);
      return;
    }

    const now = performance.now();
    const videoTime = videoEl.currentTime;

    if (videoTime > 0) {
      const result = faceLandmarker.detectForVideo(videoEl, now);
      const { dir, hasFace } = estimateDirectionFromLandmarks(result);

      bodyEl.dataset.hasFace = hasFace ? "1" : "0";

      const newDir = hasFace ? dir : "none";
      if (newDir !== currentDir) {
        currentDir = newDir;
        bodyEl.dataset.dir = currentDir;
        updateDirLabel(currentDir, hasFace);
      }

      updateFps();
    }

    requestAnimationFrame(renderLoop);
  }

  async function init() {
    try {
      setStatus("モデル読み込み中…");
      await createFaceLandmarker();
      setStatus("カメラを起動しています…");
      await setupCamera();
      setStatus("顔を左右・上下に「大きく」動かしてみてください。");
      requestAnimationFrame(renderLoop);
    } catch (err) {
      console.error(err);
      setStatus("エラーが発生しました…。コンソールを確認してください。");
      dirLabel.textContent = "カメラまたはモデルの初期化に失敗しました。";
      bodyEl.dataset.hasFace = "0";
      bodyEl.dataset.dir = "none";
    }
  }

  init();
</script>
</body>
</html>

<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="theme-color" content="#0b1020" />
  <title>æ±‚å©šã®æ—¥ï½œçŸ­æ–‡ãƒ—ãƒ­ãƒãƒ¼ã‚ºç”Ÿæˆ</title>
  <style>
    :root{
      --bg:#0b1020; --ink:#f3f6ff; --muted:rgba(243,246,255,.72);
      --line:rgba(255,255,255,.14); --panel:rgba(255,255,255,.08);
      --accent:#60a5fa; --r:18px; --shadow:0 18px 60px rgba(0,0,0,.55);
      --pad:clamp(14px,2.4vw,18px); --max:920px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%; background:var(--bg); color:var(--ink)}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
      overflow-x:hidden;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .wrap{min-height:100%; padding:calc(env(safe-area-inset-top) + 20px) var(--pad) calc(env(safe-area-inset-bottom) + 24px); display:flex; justify-content:center;}
    .app{width:min(var(--max),100%); display:flex; flex-direction:column; gap:14px;}
    header{display:flex; align-items:flex-end; justify-content:space-between; gap:12px;}
    h1{font-size:clamp(20px,3.6vw,28px); line-height:1.12;}
    .sub{margin-top:6px; color:var(--muted); font-size:12px; line-height:1.5;}
    .pill{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      padding:10px 12px; border-radius:999px;
      display:flex; gap:8px; align-items:center;
      color:var(--muted); font-size:12px; user-select:none; white-space:nowrap;
    }

    .card{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border-radius: calc(var(--r) + 4px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHead{padding:14px; border-bottom:1px solid rgba(255,255,255,.10); display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .btnRow{display:flex; gap:10px; flex-wrap:wrap; padding:12px 14px 14px; border-bottom:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.03);}
    .btn{
      border:1px solid var(--line); background: rgba(255,255,255,.06); color:var(--ink);
      padding:10px 12px; border-radius: 12px; font-size:13px; line-height:1;
      cursor:pointer; user-select:none; display:inline-flex; align-items:center; gap:8px;
    }
    .btn.primary{border-color: rgba(96,165,250,.55); background: linear-gradient(180deg, rgba(96,165,250,.22), rgba(96,165,250,.10));}
    .btn.small{padding:8px 10px; font-size:12px; border-radius: 11px}
    .btn.ghost{background: transparent}

    /* ç”»åƒï¼ˆæ¾æ‘ï¼‰ */
    .hero{
      display:flex;
      gap:12px;
      align-items:stretch;
      padding:14px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
    }
    .heroMedia{
      flex: 0 0 118px;
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      overflow:hidden;
      background: rgba(255,255,255,.04);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .heroMedia img{
      width:100%;
      height:100%;
      display:block;
      object-fit: cover;
    }
    .heroCopy{
      flex:1;
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      background: rgba(255,255,255,.03);
      padding:12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:6px;
      min-height:118px;
    }
    .heroCopy .kicker{
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }
    .heroCopy .lead{
      font-size:14px;
      line-height:1.55;
      letter-spacing:.01em;
    }

    .grid{padding:14px; display:grid; grid-template-columns:1fr; gap:12px;}
    @media (min-width:760px){ .grid{grid-template-columns:1fr 1fr 1fr;} }

    .sec{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      border-radius: 16px; overflow:hidden;
      display:flex; flex-direction:column; min-height: 140px;
    }
    .secHead{
      padding:10px; display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.03);
    }
    .left{display:flex; align-items:center; gap:10px; min-width:0;}
    .badge{width:22px; height:22px; border-radius:7px; display:grid; place-items:center; background: rgba(96,165,250,.18); border:1px solid rgba(96,165,250,.35); font-size:12px;}
    .secHead h3{font-size:13px; color: rgba(243,246,255,.92); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .secBody{padding:12px; display:flex; flex-direction:column; gap:10px; flex:1;}
    .text{
      font-size:18px;
      line-height:1.35;
      letter-spacing:.01em;
      word-break: break-word;
      font-weight: 650;
    }
    .muted{color:var(--muted); font-size:12px; line-height:1.55}
    .secFoot{padding:10px; display:flex; align-items:center; justify-content:space-between; gap:10px; border-top:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.02);}

    .result{padding:14px; border-top:1px solid rgba(255,255,255,.10); background: rgba(0,0,0,.18);}
    .resultBox{border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); border-radius:16px; padding:14px;}
    .full{font-size:22px; line-height:1.55; letter-spacing:.01em; white-space:pre-wrap; word-break: break-word;}

    .toast{
      position: fixed; left:50%;
      bottom: calc(env(safe-area-inset-bottom) + 16px);
      transform: translateX(-50%);
      background: rgba(15,23,42,.92); color: var(--ink);
      border:1px solid rgba(255,255,255,.16);
      border-radius: 999px; padding: 10px 12px; font-size: 12px;
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
      opacity:0; pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{opacity:1; transform: translateX(-50%) translateY(-2px);}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="app">
      <header>
        <div>
          <h1>çŸ­æ–‡ãƒ—ãƒ­ãƒãƒ¼ã‚ºç”Ÿæˆ</h1>
        </div>
        <div class="pill" id="seedPill" title="seedä»˜ãURLã‚’ã‚³ãƒ”ãƒ¼">
          <span>ğŸ²</span><span id="seedText">seed: ----</span>
        </div>
      </header>

      <section class="card">
        <!-- âœ… æ¾æ‘ã®ç”»åƒ -->
        <div class="hero">
          <div class="heroMedia" aria-hidden="true">
            <img id="matsumuraImg" alt="ãƒ—ãƒ­ãƒãƒ¼ã‚ºã—ã¦ã„ã‚‹æ¾æ‘" />
          </div>
          <div class="heroCopy">
            <div class="kicker">æœ¬æ—¥ã®æ¾æ‘</div>
            <div class="lead">çŸ­ãã€ã¡ã‚ƒã‚“ã¨ã€‚3è¡Œã§æ±‚å©šã™ã‚‹ã€‚</div>
          </div>
        </div>

        <div class="cardHead">
          <div style="display:flex; gap:10px; align-items:center;">
            <strong style="font-size:14px;">æ“ä½œ</strong>
            <span class="muted">ğŸ”’å›ºå®š / â†»å˜ä½“ã‚·ãƒ£ãƒƒãƒ•ãƒ«</span>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn small ghost" id="btnReset">åˆæœŸåŒ–</button>
            <button class="btn small ghost" id="btnShuffleAll">å…¨ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
          </div>
        </div>

        <div class="btnRow">
          <button class="btn primary" id="btnCopy">å…¨æ–‡ã‚³ãƒ”ãƒ¼</button>
          <button class="btn" id="btnShare">å…±æœ‰</button>
          <button class="btn" id="btnNewSeed">åˆ¥seed</button>
        </div>

        <div class="grid" id="sections"></div>

        <div class="result">
          <div class="resultBox">
            <div class="full" id="fullText">â€”</div>
          </div>
        </div>
      </section>

      <div class="toast" id="toast" role="status" aria-live="polite">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>
    </div>
  </div>

  <script type="module">
    // âœ… 1æ—¥1ã‚¢ãƒ—ãƒª assets ãƒ«ãƒ¼ãƒ«ï¼ˆVercel / é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ç”¨ï¼‰
    // ç¾åœ¨ã®ãƒ‘ã‚¹ï¼ˆä¾‹: /2026-01-27/ï¼‰ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ assets ã‚’è§£æ±ºã™ã‚‹
    const asset = (p) => {
      const basePath = window.location.pathname.replace(/\/$/, "") || "";
      return basePath + "/" + p.replace(/^\.\//, "");
    };

    // âœ… ã“ã“ã ã‘è‡ªåˆ†ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«åˆã‚ã›ã¦å¤‰æ›´
    const MATSUMURA_IMG_PATH = "./assets/matsumura-propose.png";

    // ç”»åƒã‚»ãƒƒãƒˆ
    const matsumuraImg = document.getElementById("matsumuraImg");
    matsumuraImg.src = asset(MATSUMURA_IMG_PATH);

    // ç”»åƒãŒèª­ã¿è¾¼ã‚ãªã„æ™‚ã®è¦‹ãŸç›®ï¼ˆä»»æ„ï¼‰
    matsumuraImg.addEventListener("error", () => {
      matsumuraImg.alt = "ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆassets ã«é…ç½®ã—ã¦ãã ã•ã„ï¼‰";
      matsumuraImg.style.opacity = "0.35";
    });

    // RNG
    const mulberry32 = (a) => () => {
      let t = (a += 0x6D2B79F5);
      t = Math.imul(t ^ (t >>> 15), t | 1);
      t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    };
    const nowSeed = () => {
      const d = new Date();
      const base = Number(`${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}${String(d.getHours()).padStart(2,'0')}${String(d.getMinutes()).padStart(2,'0')}`);
      const jitter = Math.floor(Math.random() * 1e6);
      return (base + jitter) >>> 0;
    };
    const pick = (rng, arr) => arr[Math.floor(rng() * arr.length)];

    // 3åˆ†å‰²ï¼šçŸ­æ–‡ç”¨
    const POOL = {
      a: ["æ¯æ—¥","ä»Šå¤œã‹ã‚‰","ã“ã‚Œã‹ã‚‰å…ˆã‚‚","ãšã£ã¨","ä¸€ç·’ã«","ã¨ãªã‚Šã§","æœ€åˆã«","æœ€å¾Œã«","ã„ã¤ã§ã‚‚","ãšã£ã¨å…ˆã¾ã§"],
      b: ["ã‚ãªãŸã®å‘³æ–¹ã‚’","ãŠå‘³å™Œæ±ã‚’","ã”ã¯ã‚“ã‚’","ç¬‘é¡”ã‚’","å¸°ã‚‹å ´æ‰€ã‚’","æœã‚’","æœªæ¥ã‚’","æ—¥å¸¸ã‚’","å®¶ã‚’","å¹¸ã›ã‚’"],
      c: ["ä½œã£ã¦ãã ã•ã„","ä½œã‚‰ã›ã¦ãã ã•ã„","ä¸€ç·’ã«ä½œã‚ã†","ãã ã•ã„","å®ˆã‚‰ã›ã¦ãã ã•ã„","å¤§äº‹ã«ã—ã¾ã™","ãã°ã«ã„ã¦ãã ã•ã„","çµå©šã—ã¦ãã ã•ã„","å®¶æ—ã«ãªã£ã¦ãã ã•ã„","ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™"]
    };

    const SECTION_DEFS = [
      { key:"a", label:"1è¡Œç›®", icon:"1" },
      { key:"b", label:"2è¡Œç›®", icon:"2" },
      { key:"c", label:"3è¡Œç›®", icon:"3" }
    ];

    const state = {
      seed: nowSeed(),
      locked: { a:false, b:false, c:false },
      choice: { a:null, b:null, c:null }
    };

    const elSections = document.getElementById("sections");
    const elFull = document.getElementById("fullText");
    const elSeedText = document.getElementById("seedText");
    const toast = document.getElementById("toast");

    function buildSections(){
      elSections.innerHTML = "";
      for (const def of SECTION_DEFS){
        const sec = document.createElement("div");
        sec.className = "sec";
        sec.dataset.key = def.key;
        sec.innerHTML = `
          <div class="secHead">
            <div class="left">
              <div class="badge" aria-hidden="true">${def.icon}</div>
              <h3>${def.label}</h3>
            </div>
            <div style="display:flex; gap:8px; align-items:center;">
              <button class="btn small" data-action="reroll" title="ã“ã®è¡Œã ã‘å†æŠ½é¸">â†»</button>
              <button class="btn small" data-action="lock" aria-pressed="false" title="å›ºå®š">ğŸ”’</button>
            </div>
          </div>
          <div class="secBody">
            <div class="text" data-role="text">â€”</div>
            <div class="muted">å€™è£œæ•°: ${POOL[def.key].length}</div>
          </div>
          <div class="secFoot">
            <button class="btn small ghost" data-action="copyOne">ã“ã®è¡Œã ã‘ã‚³ãƒ”ãƒ¼</button>
            <span class="muted" data-role="lockState">æœªå›ºå®š</span>
          </div>
        `;
        elSections.appendChild(sec);
      }
    }

    function compute(){
      const rng = mulberry32(state.seed);
      for (const def of SECTION_DEFS){
        const k = def.key;
        if (!state.locked[k] || !state.choice[k]){
          state.choice[k] = pick(rng, POOL[k]);
        } else {
          rng(); rng();
        }
      }
    }

    function fullSentence(){
      return [state.choice.a, state.choice.b, state.choice.c].filter(Boolean).join("ã€€\n");
    }

    function render(recompute=true){
      if (recompute) compute();
      elSeedText.textContent = `seed: ${String(state.seed).padStart(10,"0")}`;

      for (const def of SECTION_DEFS){
        const card = elSections.querySelector(`.sec[data-key="${def.key}"]`);
        const t = card.querySelector('[data-role="text"]');
        const lockBtn = card.querySelector('[data-action="lock"]');
        const lockState = card.querySelector('[data-role="lockState"]');

        t.textContent = state.choice[def.key] ?? "â€”";
        const locked = !!state.locked[def.key];
        lockBtn.setAttribute("aria-pressed", locked ? "true":"false");
        lockBtn.textContent = locked ? "ğŸ”" : "ğŸ”’";
        lockState.textContent = locked ? "å›ºå®šä¸­" : "æœªå›ºå®š";
      }

      elFull.textContent = fullSentence() || "â€”";
    }

    let toastTimer=null;
    const showToast = (msg) => {
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toast.classList.remove("show"), 1100);
    };

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
      }catch{
        const ta=document.createElement("textarea");
        ta.value=text; ta.style.position="fixed"; ta.style.left="-9999px";
        document.body.appendChild(ta); ta.select(); document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
      }
    }

    async function shareText(text){
      try{
        if (navigator.share) await navigator.share({ text, title:"çŸ­æ–‡ãƒ—ãƒ­ãƒãƒ¼ã‚ºç”Ÿæˆ" });
        else { await copyText(text); showToast("å…±æœ‰æœªå¯¾å¿œï¼šã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"); }
      }catch{}
    }

    function reseed(seed){
      state.seed = (seed>>>0);
      render(true);
    }

    // events
    buildSections();

    elSections.addEventListener("click", async (ev) => {
      const btn = ev.target.closest("button");
      if (!btn) return;
      const card = ev.target.closest(".sec");
      if (!card) return;

      const key = card.dataset.key;
      const action = btn.dataset.action;

      if (action === "lock"){
        state.locked[key] = !state.locked[key];
        render(false);
      }
      if (action === "reroll"){
        const rng = mulberry32((state.seed ^ (Date.now() & 0xffffffff)) >>> 0);
        state.choice[key] = pick(rng, POOL[key]);
        render(false);
      }
      if (action === "copyOne"){
        await copyText(state.choice[key] ?? "");
      }
    });

    document.getElementById("btnShuffleAll").addEventListener("click", () => reseed(nowSeed()));
    document.getElementById("btnNewSeed").addEventListener("click", () => { reseed(nowSeed()); showToast("seedå¤‰æ›´"); });

    document.getElementById("btnReset").addEventListener("click", () => {
      state.locked = { a:false, b:false, c:false };
      state.choice = { a:null, b:null, c:null };
      reseed(nowSeed());
      showToast("åˆæœŸåŒ–ã—ã¾ã—ãŸ");
    });

    document.getElementById("btnCopy").addEventListener("click", async () => copyText(fullSentence()));
    document.getElementById("btnShare").addEventListener("click", async () => shareText(fullSentence()));

    // iOS Safari: ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—æ‹¡å¤§æŠ‘åˆ¶
    let lastTouchEnd=0;
    document.addEventListener("touchend", (e) => {
      const now=Date.now();
      if (now - lastTouchEnd <= 260) e.preventDefault();
      lastTouchEnd = now;
    }, { passive:false });

    // ?seed= ã§å¾©å…ƒ
    (() => {
      const sp = new URLSearchParams(location.search);
      const s = sp.get("seed");
      if (!s) return;
      const n = Number(s);
      if (Number.isFinite(n)) reseed(n>>>0);
    })();

    // seedã‚¯ãƒªãƒƒã‚¯ã§URLã‚³ãƒ”ãƒ¼
    document.getElementById("seedPill").addEventListener("click", async () => {
      const u = new URL(location.href);
      u.searchParams.set("seed", String(state.seed>>>0));
      try{ await navigator.clipboard.writeText(u.toString()); showToast("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"); }catch{ showToast("seedä»˜ä¸æ¸ˆã¿"); }
      history.replaceState(null, "", u);
    });

    render(true);
  </script>
</body>
</html>

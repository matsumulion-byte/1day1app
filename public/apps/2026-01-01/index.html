<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
<title>松村おみくじ</title>
<meta name="theme-color" content="#0b1020" />

<style>
:root{
  --bg:#070a14;
  --ink:#f3f6ff;
  --muted:rgba(243,246,255,.72);
  --line:rgba(255,255,255,.14);
  --accent:#60a5fa;
  --gold:#f6c177;
  --r:18px;
}
*{box-sizing:border-box;margin:0;padding:0;user-select:none;}
html,body{
  height:100%;
  overflow:hidden;
  font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif;
  color:var(--ink);
  background:
    radial-gradient(1200px 700px at 50% 0%, #0f1a35 0%, var(--bg) 55%),
    radial-gradient(900px 600px at 12% 10%, rgba(246,193,119,.12), transparent 62%),
    radial-gradient(900px 600px at 88% 14%, rgba(251,113,133,.10), transparent 64%);
}

/* ===== layout ===== */
.wrap{
  height:100%;
  max-width:720px;
  margin:0 auto;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1{ font-size:18px; letter-spacing:.08em; }
header .date{ font-size:12px; color:var(--muted); }

.mizuhiki{
  height:10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:linear-gradient(90deg,
    rgba(251,113,133,0),
    rgba(251,113,133,.22),
    rgba(246,193,119,.18),
    rgba(96,165,250,.18),
    rgba(96,165,250,0)
  );
}

main{
  flex:1;
  border:1px solid var(--line);
  border-radius:var(--r);
  background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.04));
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ===== stage ===== */
.stage{
  flex:1;
  display:grid;
  place-items:center;
  position:relative;
}
.stage::before{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.35);
  opacity:0;
  transition:.22s;
  pointer-events:none;
}
.stage.showResult::before{ opacity:1; }

/* petals */
.petals{ position:absolute; inset:0; pointer-events:none; z-index:0; }
.petal{
  position:absolute;
  width:10px;height:10px;
  border-radius:10px 0 10px 0;
  background:#fff;
  opacity:.18;
  animation:fall linear infinite;
}
@keyframes fall{
  from{ transform:translate(var(--x),-10vh) rotate(0); }
  to{ transform:translate(calc(var(--x) + var(--d)),120vh) rotate(240deg); }
}

/* ===== box ===== */
.box{
  width:min(360px,92%);
  aspect-ratio:1/1;
  display:grid;
  place-items:center;
  z-index:2;
  transition:.22s;
}
.stage.showResult .box{
  opacity:0;
  transform:scale(.92) translateY(10px);
  filter:blur(2px);
}
.disc{
  width:100%;height:100%;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(600px 400px at 50% 10%, rgba(246,193,119,.22), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.05));
  display:grid;
  place-items:center;
}
.face{
  width:86%;height:86%;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.25);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:10px;
  padding:12px;
  text-align:center;
}
.guji{
  width:min(180px,55vw);
  filter:drop-shadow(0 18px 45px rgba(0,0,0,.55));
}
.stage.showResult #gujiIdle{ opacity:0; }

.face h2{ font-size:16px; letter-spacing:.08em; }
.face p{ font-size:12px; color:var(--muted); }

/* ===== result ===== */
.resultWrap{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  opacity:0;
  transform:translateY(12px);
  transition:.25s;
  z-index:4;
}
.resultWrap.show{ opacity:1; transform:none; }

.paper{
  width:min(420px,94%);
  padding:16px 160px 16px 16px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.16);
  background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06));
  position:relative;
}
.paper h3{
  font-size:24px;
  letter-spacing:.1em;
  text-shadow:0 0 18px rgba(246,193,119,.25);
}
.paper .msg{ margin:6px 0 10px; }

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}
.kv{
  padding:8px 10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.18);
}
.k{ font-size:11px;color:var(--muted); }
.v{ font-size:13px;font-weight:700; }

.gujiPaper{
  position:absolute;
  right:14px;
  bottom:12px;
  height:calc(100% - 24px);
  width:auto;
  object-fit:contain;
  filter:drop-shadow(0 18px 55px rgba(0,0,0,.55));
}

/* ===== footer ===== */
footer{
  padding:12px;
  display:flex;
  gap:10px;
}
button{
  flex:1;
  height:44px;
  border-radius:14px;
  border:1px solid var(--line);
  background:linear-gradient(180deg,rgba(255,255,255,.14),rgba(255,255,255,.06));
  color:var(--ink);
  font-weight:700;
}
button.primary{ border-color:rgba(96,165,250,.6); }
</style>
</head>

<body>
<div class="wrap">

<header>
  <h1>松村おみくじ</h1>
  <div class="date" id="today"></div>
</header>
<div class="mizuhiki"></div>

<main>
<div class="stage" id="stage">
  <div class="petals" id="petals"></div>

  <div class="box">
    <div class="disc">
      <div class="face">
        <img id="gujiIdle" class="guji" alt="宮司松村">
        <h2>おみくじ箱</h2>
        <p>ボタンを押して<br>運だめし</p>
      </div>
    </div>
  </div>

  <div class="resultWrap" id="resultWrap">
    <div class="paper">
      <h3 id="rank"></h3>
      <div class="msg" id="msg"></div>
      <div class="grid">
        <div class="kv"><div class="k">仕事</div><div class="v" id="wWork"></div></div>
        <div class="kv"><div class="k">恋愛</div><div class="v" id="wLove"></div></div>
        <div class="kv"><div class="k">健康</div><div class="v" id="wHealth"></div></div>
        <div class="kv"><div class="k">金運</div><div class="v" id="wMoney"></div></div>
      </div>
      <img id="gujiPaper" class="gujiPaper" alt="">
    </div>
  </div>
</div>

<footer>
  <button id="resetBtn">戻る</button>
  <button class="primary" id="drawBtn">引く</button>
</footer>
</main>
</div>

<script type="module">
// Vercel用のパス解決ヘルパー
const DATE_SEGMENT = (location.pathname.match(/\d{4}-\d{2}-\d{2}/) || [""])[0];
const DATE_BASE = DATE_SEGMENT ? `/${DATE_SEGMENT}/` : "/";
const asset = (p) => {
  const clean = String(p || "").replace(/^\.?\//, "");
  return `${DATE_BASE}${clean}`;
};
const $ = id => document.getElementById(id);

/* date */
const d = new Date();
$('today').textContent = `${d.getMonth()+1}月${d.getDate()}日`;

/* images */
const src = asset('./assets/guji_matsu.png');
$('gujiIdle').src = src;
$('gujiPaper').src = src;

/* petals */
for(let i=0;i<7;i++){
  const p=document.createElement('i');
  p.className='petal';
  p.style.setProperty('--x',Math.random()*100+'vw');
  p.style.setProperty('--d',(Math.random()*40-20)+'vw');
  p.style.animationDuration=(10+Math.random()*10)+'s';
  p.style.animationDelay=(-(Math.random()*10))+'s';
  $('petals').appendChild(p);
}

/* fortunes */
const fortunes = [
  {r:'大吉',m:'めっちゃいい感じ！',w:['めっちゃいい','やばい','元気！','5億get!']},
  {r:'中吉',m:'いい感じ！',w:['安定','告っちゃえ！','まぁそれなりに','宝くじ買お']},
  {r:'吉',m:'普通が最強。',w:['普通','自然体','歩け','予定通り']},
  {r:'凶',m:'逆にいい感じ！',w:['辞めちゃえ！','フラれる','やばい','財布を落とす']},
  {r:'松吉',m:'松村です。',w:['働きたくない','モテる','健診行こ','5兆円欲しい']}
];

function draw(){
  const f = fortunes[Math.floor(Math.random()*fortunes.length)];
  $('rank').textContent = f.r;
  $('msg').textContent = f.m;
  $('wWork').textContent = f.w[0];
  $('wLove').textContent = f.w[1];
  $('wHealth').textContent = f.w[2];
  $('wMoney').textContent = f.w[3];

  $('resultWrap').classList.add('show');
  $('stage').classList.add('showResult');
}

/* buttons */
$('drawBtn').onclick = draw;
$('resetBtn').onclick = ()=>{
  $('resultWrap').classList.remove('show');
  $('stage').classList.remove('showResult');
};
</script>
</body>
</html>
